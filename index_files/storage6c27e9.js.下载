function _typeof(t){
return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t;
}
define("common/keyboard.js",["biz_wap/jsapi/core.js","biz_common/dom/event.js","biz_wap/utils/mmversion.js","pages/bottom_input_bar.js","common/utils.js"],function(t){
"use strict";
var e=t("biz_wap/jsapi/core.js"),n=t("biz_common/dom/event.js"),o=t("biz_wap/utils/mmversion.js"),i=t("pages/bottom_input_bar.js"),s=t("common/utils.js"),a=o.getInner(),r={
vertical:0,
horizontal:0
};
0===window.orientation||180===window.orientation?(r.vertical=s.getInnerHeight(),
r.horizontal=screen.width-(screen.height-r.vertical)):(r.horizontal=s.getInnerHeight(),
r.vertical=screen.width-(screen.height-r.horizontal+60));
var c=!1,u=!1,d=!0;
o.isIOS&&o.gtVersion("7.0.16")?(c=!0,u=!0,o.gtVersion("8.0.19",!0)&&(d=!1)):o.isAndroid&&(o.gtVersion("7.0.18")&&"27001634">a||a>="28000038")&&(c=!0,
u=a>="27001700",a>="280014A9"&&(d=!1));
var l={
keyboard:0,
input:0,
cmtInput:0
},f=[],p=!1,h=null,m=!1,y=null,b=null,g=null,w=!1,v=!1;
c&&(u&&(h=document.createElement("div"),h.style.cssText="width: 100%; height: 100%; position: fixed; top: 0; background-color: transparent; z-index: 99999999; display: none;",
document.body.appendChild(h),n.on(h,"touchmove",function(t){
m&&t.preventDefault();
})),s.listenStateChange({
cb:function(t){
"onDestroy"===t.state&&(h&&(h.style.display="none"),"function"==typeof b&&b(""),
"function"==typeof g&&g(""));
}
}));
var j=function(){
return c?!0:(console.log("Not support keyboard."),!1);
},C=function(t,e){
w&&(e=y.$inputWrapper.height()),f.length&&f.forEach(function(n){
"function"==typeof n&&n({
keyboard:t,
input:e,
updateKeyboard:l.keyboard!==t,
updateInput:!v&&l.input!==e,
updateCmtInput:v&&l.cmtInput!==e
});
}),l.keyboard=t,l[v?"cmtInput":"input"]=e;
};
return{
canUseKeyboard:c,
canUseCancel:u,
onlyUseH5Keyboard:d,
lastData:l,
onGetKeyboardHeight:function(t){
-1===f.indexOf(t)&&(p||(p=!0,e.on("onGetKeyboardHeight",function(t){
return C(t.height,t.inputHeight);
})),f.push(t));
},
offGetKeyboardHeight:function(t){
var e=f.indexOf(t);
e>-1&&f.splice(e,1);
},
show:function(t){
if(j()||t.forceFallback||t.forceFallbackIfUnsupport){
if(b=t.cancel,g=t.hide,d||t.forceFallback){
var n=function(){
w=!0,y||(y=new i);
var e=!1;
return y.addListener("submit",function(){
e=!0,"function"==typeof t.success&&t.success(y.getContent());
}),y.addListener("hide",function(t){
var n=y.getContent();
e||"function"==typeof b&&b(n),"function"==typeof g&&g(n,t),e=!1;
}),y.addListener("show",function(){
"function"==typeof t.show&&t.show();
}),y.addListener("input",function(){
"function"==typeof t.input&&t.input(y.getContent());
}),y.addListener("fail",function(){
"function"==typeof t.fail&&t.fail();
}),y.addListener("showEmotionPanel",function(e){
"function"==typeof t.showEmotionPanel&&t.showEmotionPanel(e);
}),y.addListener("hideEmotionPanel",function(){
"function"==typeof t.hideEmotionPanel&&t.hideEmotionPanel();
}),y.addListener("inputHeightChange",function(e){
l.input=e,"function"==typeof t.inputHeightChange&&t.inputHeightChange(e);
}),y.setContent(t.text||""),y.setLimit(t.maxLength||0),y.setPlaceholder(t.placeholder||""),
y.show(t.toggleEmotion,t.isFullscreen,t.isLandscape),{
v:void 0
};
}();
if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v;
}
w=!1;
var s={
text:t.text||"",
placeholder:(o.isIOS?"native":"")+(t.placeholder||""),
maxLength:t.maxLength||0,
showRemindWordCount:t.showRemindWordCount||0,
disableScrollAdjustment:void 0===t.disableScrollAdjustment?!0:t.disableScrollAdjustment,
customParams:{}
};
t.scrollContentY&&(s.scrollContentY=t.scrollContentY),t.mask&&h&&(h.style.display=""),
m=!!t.disableScroll,"comment"===t.type?(v=!0,s.customParams={
showType:1,
sendButtonWord:"留言",
leftWords:"写留言",
rightWords:"取消",
editBoxHeight:120
}):"reply"===t.type&&(s.customParams={
showType:0,
sendButtonWord:"回复"
}),s.customParams.switchToSmile=!!t.toggleEmotion,e.invoke("showKeyboard",s,function(e){
switch(v=!1,h&&(h.style.display="none"),e.err_msg){
case"showKeyboard:ok":
"function"==typeof t.success&&t.success(e.text);
break;

case"showKeyboard:cancel":
"function"==typeof b&&b(e.text);
}
"function"==typeof g&&g(e.text);
}),"function"==typeof t.show&&t.show();
}
},
hide:function(){
d?y&&y.hide():e.invoke("showKeyboard",{
hidden:!0
});
}
};
});define("biz_common/utils/comm_report.js",[],function(){
"use strict";
var r={
web:{
report:"/cgi-bin/webreport"
},
wap:{
report:"/mp/wapcommreport"
}
},o=function(r,o){
return o=JSON.parse(JSON.stringify(o)),o.log_id=r,console.log("[comm_report] reportjson: ",o),
JSON.stringify(o);
},e=function(r,o,e){
return function(n){
n&&0!==n.err_code&&console.warn("[comm_report] report "+r+" fail: ",n.err_msg,o),
"function"==typeof e.success&&e.success(n);
};
},n=function(r,o,e){
return function(n,t){
console.error("[comm_report] report "+r+" error: ",t,o),"function"==typeof e.error&&e.error(n,t);
};
},t=!1,c=[],p={
web:{
report:function(t,c,p,s){
s=s||{},t.post({
url:r.web.report,
data:{
reportjson:o(c,p)
},
async:s.async,
success:e(c,p,s),
error:n(c,p,s)
});
},
leaveReport:function(r,o,e){
if(c.push([r,o,e]),!t){
t=!0;
var n=!1,s=function(){
n||(n=!0,c.forEach(function(r){
p.web.report(r[0],r[1],r[2]);
}));
};
window.addEventListener("beforeunload",s,!1),window.addEventListener("unload",s,!1);
}
}
},
wap:{
report:function(t,c,p,s){
s=s||{},t({
type:"POST",
dataType:"json",
url:r.wap.report,
data:{
reportjson:o(c,p)
},
async:s.async,
success:e(c,p,s),
error:n(c,p,s)
});
}
}
};
return{
report:function(r,o,e,n,t){
p[r].report(o,e,n,t);
},
leaveReport:function(r,o,e,n){
p[r].leaveReport(o,e,n);
},
getUrl:function(o,e){
return r[o][e];
},
getData:function(r,e,n){
var t=o(r,e);
return n&&(t=encodeURIComponent(t)),"reportjson="+t;
}
};
});define("new_video/ctl.js",["common/comm_report.js","biz_wap/utils/ajax.js"],function(e){
"use strict";
var i,r=window.withoutIframe?window:window.parent.window,t=e("common/comm_report.js");
if(parent==window)i=window;else try{
{
r.location.href;
}
i=r;
}catch(n){
i=window;
}
var a=i.user_uin,o=Math.floor(i.user_uin/100)%20;
a||(o=-1);
var d=function(){
return o>=0;
};
i.__webviewid||(i.__webviewid=+new Date+"_"+Math.ceil(1e3*Math.random()));
var s=function(){
var e=i.mid,r=i.idx,t="";
t=e&&r?e+"_"+r:"";
var n=i.__webviewid,o=[a,t,n].join("_");
return o;
},c=function(i){
if(20>o)try{
var t=i.vid||"",n={};
n.__biz=r.biz||"",n.vid=t,n.clienttime=+new Date;
var a=r.mid,c=r.idx,p="";
p=a&&c?a+"_"+c:t,n.type="undefined"!=typeof i.type?i.type:a&&c?1:2,n.id=p,n.hit_bizuin=i.hit_bizuin||"",
n.hit_vid=i.hit_vid||"",n.webviewid=s(),n.step=i.step||0,n.orderid=i.orderid||0,
n.ad_source=i.ad_source||0,n.traceid=i.traceid||0,n.ext1=i.ext1||"",n.ext2=i.ext2||"",
n.r=Math.random(),n.devicetype=r.devicetype,n.version=r.clientversion,n.is_gray=d()?1:0,
n.mid=a||"",n.idx=c||"",n.url=r.location.href,n.screen_num=i.screen_num||0,n.screen_height=i.screen_height||0,
n.ori_status=i.ori_status||3,n.fromid=i.fromid||0,n.sessionid=window.sessionid||"",
n.appmsg_scene=window.source||(i.cgiData?i.cgiData.scene:0)||0,!n.appmsg_scene&&n.fromid?n.appmsg_scene=n.fromid:!n.fromid&&n.appmsg_scene&&(n.fromid=n.appmsg_scene),
n.total_range=i.total_range||0,n.current_range=i.current_range||0,n.duration=i.duration||0;
var m=e("biz_wap/utils/ajax.js");
m({
url:"/mp/ad_video_report?action=user_action",
type:"post",
data:n
});
}catch(_){}
},p=function(e){
try{
var i=e.vid||"",n={};
n.BizUin=r.biz||"",n.Vid=i,n.ClientTime=+new Date;
var a=r.mid,o=r.idx,c="";
c=a&&o?a+"_"+o:i,n.Type="undefined"!=typeof e.type?e.type:a&&o?1:2,n.Id=c,n.HitBizUin=parseInt(e.hit_bizuin)||0,
n.HitVid=e.hit_vid||"",n.WebViewId=s(),n.Step=parseInt(e.step,10)||0,n.OrderId=(e.orderid||"").toString(),
n.AdSource=parseInt(e.ad_source,10)||0,n.TraceId=(e.traceid||"").toString(),n.Ext1=(e.ext1||"").toString(),
n.Ext2=(e.ext2||"").toString(),n.r=Math.random(),n.DeviceType=r.devicetype,n.ClientVersion=parseInt(r.clientversion),
n.IsGray=d()?1:0,n.msgid=parseInt(a,10)||0,n.itemidx=parseInt(o,10)||0,n.Url=r.location.href,
n.ScreenNum=parseInt(e.screen_num,10)||0,n.ScreenHeight=parseInt(e.screen_height,10)||0,
n.OrStatus=parseInt(e.ori_status,10)||3,n.Fromid=parseInt(e.fromid,10)||0,n.SessionId=(window.sessionid||"").toString(),
n.AppmsgScene=parseInt(window.source||(e.cgiData?e.cgiData.scene:0),10)||0,!n.AppmsgScene&&n.Fromid?n.AppmsgScene=n.Fromid:!n.Fromid&&n.AppmsgScene&&(n.Fromid=n.AppmsgScene),
n.AppmsgScene=parseInt(n.AppmsgScene,10)||0,n.Fromid=parseInt(n.Fromid,10)||0,n.TotalRange=parseInt(e.total_range,10)||0,
n.CurrentRange=parseInt(e.current_range,10)||0,n.Duration=parseInt(e.duration,10)||0,
n.RemindTrafficSize=parseInt(e.remind_traffic_size,10)||0,n.TrafficReminderType=parseInt(e.traffic_reminder_type,10)||0,
t.report(12710,n);
}catch(p){}
};
return{
report:c,
getWebviewid:s,
showAd:d,
commReport:p
};
});define("pages/video_communicate_adaptor.js",["pages/player_tips.js"],function(t){
"use strict";
function e(){
window.addEventListener("message",i,!1),p();
}
function i(t){
var e;
if(t.origin?e=t.origin:t.originalEvent&&(e=t.originalEvent.origin),/^http(s)?\:\/\/mp\.weixin\.qq\.com$/.test(e)&&t.source){
var i=t.data;
if(i&&i.type){
if(!/^mpvideo_/.test(i.type))return;
var o=i.type.replace(/^mpvideo_/,"");
/^broadcast_/.test(o)?u.postMessageEvt.broadcast({
data:i.data,
type:o
}):u.postMessageEvt[o]&&u.postMessageEvt[o](i.data);
}
}
}
function o(t){
var e=t.type.replace(/^broadcast_/,""),i=d();
if(i.length>0)for(var o=0,a=i.length;a>o;o++){
var r=i[o];
n({
win:r.contentWindow,
type:e,
data:t.data
});
}
n({
win:window,
type:e,
data:t.data
});
}
function n(t){
var e=t.type;
/^mpvideo_/.test(e)||(e="mpvideo_"+e);
var i={
data:t.data,
type:e
};
t.win.postMessage(i,document.location.protocol+"//mp.weixin.qq.com");
}
function a(){
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
t.msg&&new f({
msg:t.msg
});
}
function r(t){
for(var e=d({
vid:t.vid
}),i=0,o=e.length;o>i;i++){
var a=e[i];
a.style.display="";
var r=a.parentNode,s=r.querySelectorAll('.js_img_loading[data-vid="'+t.vid+'"]');
if(s&&s.length>0)for(var i=0,o=s.length;o>i;i++)r.removeChild(s[i]);
n({
type:"afterRemoveLoading",
win:a.contentWindow
});
}
}
function d(t){
t=t||{};
for(var e=document.getElementsByTagName("iframe"),i=[],o=0,n=e.length;n>o;o++){
var a=e[o],r=a.getAttribute("src");
if(window.__second_open__&&(r=a.getAttribute("data-realsrc")),r&&-1!=r.indexOf("/mp/videoplayer")){
if("undefined"!=typeof t.vid){
var d=r.match(/[\?&]vid\=([^&]*)/);
if(!d||!d[1]||d[1]!=t.vid)continue;
}
i.push(a);
}
}
return i;
}
function s(t){
if(t.height){
var e=d({
vid:t.vid
});
if(0!=e.length){
var i=e[0],o=i.offsetHeight+1*t.height;
i.setAttribute("height",o),i.setAttribute("data-additionalheight",t.height),i.style.setProperty&&i.style.setProperty("height",o+"px","important");
}
}
}
function v(t){
u.videoInfo[t.vid]||(u.videoInfo[t.vid]={}),u.videoInfo[t.vid].ori_status=t.ori_status,
u.videoInfo[t.vid].hit_bizuin=t.hit_bizuin,u.videoInfo[t.vid].hit_vid=t.hit_vid;
}
function p(){
"function"==typeof window.__getVideoWh&&window.addEventListener("resize",function(){
for(var t=d(),e=0,i=t.length;i>e;e++){
var o=t[e];
setTimeout(function(t){
return function(){
var e=window.__getVideoWh(t),i=e.w,o=e.h,n=1*t.getAttribute("data-additionalheight");
n&&(o+=n),t.setAttribute("width",i),t.setAttribute("height",o),t.style.setProperty&&(t.style.setProperty("width",i+"px","important"),
t.style.setProperty("height",o+"px","important"));
};
}(o),50);
}
},!1);
}
function g(){
return u.videoInfo;
}
var f=t("pages/player_tips.js"),u={
videoInfo:{},
postMessageEvt:{
broadcast:o,
removeVideoLoading:r,
addVideoIframeHeight:s,
videoInited:v,
showTips:a
}
};
return e(),{
getVideoInfo:g
};
});define("appmsg/without_iframe/video_communicate_adaptor.js",["pages/player_tips.js","appmsg/without_iframe/iframe_communicate.js"],function(t){
"use strict";
function e(t){
t=t||{};
for(var e=document.getElementsByClassName("video_iframe"),i=[],o=0,r=e.length;r>o;o++){
var n=e[o],a=n.getAttribute("vid");
("undefined"==typeof t.vid||a===t.vid)&&i.push(n);
}
return i;
}
function i(t){
for(var i=e({
vid:t.vid
}),o=0,r=i.length;r>o;o++){
var n=i[o];
n.style.display="";
var a=n.parentNode,d=a.querySelectorAll('.js_img_loading[data-vid="'+t.vid+'"]');
if(d&&d.length>0)for(var s=0,v=d.length;v>s;s++)a.removeChild(d[s]);
u.triggerListener({
type:"afterRemoveLoading",
vid:t.vid
});
}
}
function o(t){
if(t.height){
var i=e({
vid:t.vid
});
if(0!==i.length){
var o=i[0],r=o.offsetHeight+1*t.height;
o.setAttribute("height",r),o.setAttribute("data-additionalheight",t.height),o.style.setProperty&&o.style.setProperty("height",r+"px","important");
}
}
}
function r(t){
h.videoInfo[t.vid]||(h.videoInfo[t.vid]={}),h.videoInfo[t.vid].ori_status=t.ori_status,
h.videoInfo[t.vid].hit_bizuin=t.hit_bizuin,h.videoInfo[t.vid].hit_vid=t.hit_vid;
}
function n(){
return h.videoInfo;
}
function a(t){
var e=t.type.replace(/^broadcast_/,"");
u.triggerListener({
type:e,
data:t.data
});
}
function d(){
var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
t.msg&&new f({
msg:t.msg
});
}
function s(t){
var e=void 0;
if(t.origin?e=t.origin:t.originalEvent&&(e=t.originalEvent.origin),/^http(s)?\:\/\/mp\.weixin\.qq\.com$/.test(e)&&t.source){
var i=t.data;
if(i&&i.type){
if(!/^mpvideo_/.test(i.type))return;
var o=i.type.replace(/^mpvideo_/,"");
/^broadcast_/.test(o)?p.broadcast({
data:i.data,
type:o
}):p[o]&&p[o](i.data);
}
}
}
function v(){
"function"==typeof window.__getVideoWh&&window.addEventListener("resize",function(){
for(var t=e(),i=0,o=t.length;o>i;i++){
var r=t[i];
setTimeout(function(t){
return function(){
var e=window.__getVideoWh(t),i=e.w,o=e.h,r=1*t.getAttribute("data-additionalheight");
r&&(o+=r),t.setAttribute("width",i),t.setAttribute("height",o),t.style.setProperty&&(t.style.setProperty("width",i+"px","important"),
t.style.setProperty("height",o+"px","important"));
};
}(r),0);
}
},!1);
}
function g(){
window.addEventListener("message",s,!1),v();
}
var f=t("pages/player_tips.js"),u=t("appmsg/without_iframe/iframe_communicate.js"),h={
videoInfo:{},
videoCbs:{}
},p={
broadcast:a,
removeVideoLoading:i,
addVideoIframeHeight:o,
videoInited:r,
showTips:d
};
return g(),{
getVideoInfo:n
};
});function _classCallCheck(t,s){
if(!(t instanceof s))throw new TypeError("Cannot call a class as a function");
}
var _createClass=function(){
function t(t,s){
for(var i=0;i<s.length;i++){
var r=s[i];
r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r);
}
}
return function(s,i,r){
return i&&t(s.prototype,i),r&&t(s,r),s;
};
}();
define("pages/modules/class_utils/check_exposed.js",["pages/utils.js"],function(t,s,i){
"use strict";
var r=t("pages/utils.js"),e=function(t){
return null!==t&&t.window===t;
},o=function(){
function t(s){
var i=s.container,r=void 0===i?window:i,e=s.domList,o=void 0===e?[]:e,a=s.exposedRatio,n=void 0===a?.5:a;
_classCallCheck(this,t),this.container=r,this.domList=[],this.exposedRatio=n,this.direc="",
this.scrollAction={
x:"",
y:""
},this.boundaryFirstIdx=-1,this.boundaryLastIdx=-1,this.lastBoundaryFirstIdx=-1,
this.lastBoundaryLastIdx=-1,this.notFoundFirstScreen=!1,this.updateDomList(o),this.getBoundaryIdx();
}
return _createClass(t,[{
key:"getBoundaryIdx",
value:function(){
var t=this;
this.checkValidity(),this.boundaryFirstIdx=-1,this.boundaryLastIdx=-1,this.domList.some(function(s,i){
return t.isExposed(s)?(t.setBoundaryFirstIdx(i,i),!0):!1;
}),-1===this.boundaryFirstIdx?(this.notFoundFirstScreen=!0,this.setBoundaryFirstIdx(0,0)):this.notFoundFirstScreen=!1,
this.domList.slice(this.boundaryFirstIdx+1).some(function(s,i){
return t.isExposed(s)?!1:(t.setBoundaryLastIdx(i+t.boundaryFirstIdx,i+t.boundaryFirstIdx),
!0);
}),-1===this.boundaryLastIdx&&this.setBoundaryLastIdx(this.domList.length-1,this.domList.length-1);
}
},{
key:"checkExposed",
value:function(){
if(this.checkValidity(),this.calcScrollDirec(),"up"===this.direc){
for(var t=this.boundaryLastIdx;t>=0;--t){
var s=this.domList[t];
if(this.isExposed(s)){
this.setBoundaryLastIdx(t,this.boundaryLastIdx);
break;
}
0>=t&&this.setBoundaryLastIdx(this.domList.length-1,this.boundaryLastIdx);
}
for(var i=this.boundaryLastIdx-1;i>=0;--i){
var s=this.domList[i];
if(!this.isExposed(s)){
this.setBoundaryFirstIdx(i+1,this.boundaryFirstIdx);
break;
}
0>=i&&this.setBoundaryFirstIdx(0,this.boundaryFirstIdx);
}
}else{
for(var t=this.boundaryFirstIdx;t<this.domList.length;++t){
var s=this.domList[t];
if(this.isExposed(s)){
this.setBoundaryFirstIdx(t,this.boundaryFirstIdx);
break;
}
t>=this.domList.length-1&&this.setBoundaryFirstIdx(0,this.boundaryFirstIdx);
}
for(var i=this.boundaryFirstIdx+1;i<this.domList.length;++i){
var s=this.domList[i];
if(!this.isExposed(s)){
this.setBoundaryLastIdx(i-1,this.boundaryLastIdx);
break;
}
i>=this.domList.length-1&&this.setBoundaryLastIdx(this.domList.length-1,this.boundaryLastIdx);
}
}
return this.domList.slice(this.boundaryFirstIdx,this.boundaryLastIdx+1);
}
},{
key:"calcScrollDirec",
value:function(){
var t=e(this.container)?window.scrollX:this.container.scrollLeft,s=e(this.container)?window.scrollY:this.container.scrollTop;
this.scrollAction.x||this.scrollAction.y||(this.scrollAction.x=t,this.scrollAction.y=s);
var i=this.scrollAction.x-t,r=this.scrollAction.y-s;
0>i?this.direc="right":i>0?this.direc="left":0>r?this.direc="down":r>0&&(this.direc="up"),
this.scrollAction.x=t,this.scrollAction.y=s;
}
},{
key:"isExposed",
value:function(t){
return r.checkExposedStatus(t,this.exposedRatio,"vertical",this.container);
}
},{
key:"updateDomList",
value:function(s){
t.checkDomListValidity(s),this.domList=Array.from(s),this.getBoundaryIdx();
}
},{
key:"setBoundaryFirstIdx",
value:function(s,i){
t.checkSetValidity(s,i,"upper"),this.lastBoundaryFirstIdx=i,this.boundaryFirstIdx=s;
}
},{
key:"setBoundaryLastIdx",
value:function(s,i){
t.checkSetValidity(s,i,"lower"),this.lastBoundaryLastIdx=i,this.boundaryLastIdx=s;
}
},{
key:"checkValidity",
value:function(){
this.boundaryFirstIdx>this.boundaryLastIdx&&console.error("Please make sure that boundaryFirstIdx is less than boundaryLastIdx!");
}
}],[{
key:"checkDomListValidity",
value:function(t){
"[object HTMLCollection]"!==Object.prototype.toString.apply(t)&&"[object Array]"!==Object.prototype.toString.apply(t)&&console.error("Please make sure that the new value is an array or array-like!"),
t.length||console.error("DomList is empty!");
}
},{
key:"checkSetValidity",
value:function(t,s,i){
switch((0>t||0>s)&&console.error("Please make sure that boundaryLastIdx is not less than zero!"),
i){
case"upper":
(t>this.boundaryLastIdx||s>this.lastBoundaryLastIdx)&&console.error("Please make sure that the new value is less than boundaryLastIdx and lastBoundaryLastIdx!");
break;

case"lower":
default:
(t<this.boundaryFirstIdx||s<this.lastBoundaryFirstIdx)&&console.error("Please make sure that the new value is more than boundaryFirstIdx and lastBoundaryFirstIdx!");
}
}
}]),t;
}();
i.exports=o;
});function _typeof(e){
return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e;
}
var _extends=Object.assign||function(e){
for(var t=1;t<arguments.length;t++){
var n=arguments[t];
for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);
}
return e;
};
define("pages/modules/tag_report/tag_report.js",["common/comm_report.js","pages/utils.js"],function(e,t,n){
"use strict";
function i(e){
return null!==e&&"object"===("undefined"==typeof e?"undefined":_typeof(e));
}
var a=e("common/comm_report.js"),o=e("pages/utils.js");
"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{
value:function(e){
if(null==e)throw new TypeError("Cannot convert undefined or null to object");
for(var t=Object(e),n=1;n<arguments.length;n+=1){
var i=arguments[n];
if(null!=i)for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a]);
}
return t;
},
writable:!0,
configurable:!0
});
var r={
Scene:178,
SubScene:1*window.subscene,
EnterId:1*window.enterid
},d={
RelatedTitleList:"",
Scene:1*window.source,
SubScene:1*window.subscene,
Url:function(){
return location.href.includes("#")?location.href:location.href+"#wechat_redirect";
}()
},p={
RelatedTitleList:"",
SessionId:window.sessionid+"",
EnterId:1*window.enterid
},s=function(e){
var t=o.getUrlParamsMap(e.jumpUrl);
a.report(19649,_extends({},r,{
Vid:e.vid?e.vid+"":"",
SceneNote:1*window.source===159?e.jumpUrl:"",
AlbumId:e.albumId+"",
AlbumType:1*e.albumType,
EventType:1*e.eventType,
Pos:1*e.pos,
IfSubscription:1*e.isSubscribed===1?2:1,
NewTagId:e.tagId+"",
ShowTag:e.tagName+"",
InsideTag:e.insideTag+"",
Cate1:e.c1Report+"",
Cate2:e.c2Report+"",
ArticleSource:2,
SubBizUin:t.__biz+"",
SubMsgId:1*t.mid,
SubItemIdx:1*t.idx,
AutoPlay:1*e.canAutoPlay,
StartTime:1*e.startTime,
EndTime:1*e.endTime,
PlayDuration:e.playDuration?1*e.playDuration:0,
VideoDuration:e.videoDuration?1*e.videoDuration:0,
BuffDuration:e.buffDuration?1*e.buffDuration:0,
Recinfo:(i(e.recInfo)?JSON.stringify(e.recInfo):e.recInfo)||""
}));
},T=function(e){
var t=_extends({},d,{
EventType:1*e.eventType,
Title:e.tagName+"",
TitleType:1*e.titleType,
ArticleCnt:e.mpMsgs.length,
ItemShowType:1===e.msgType?0:5,
BizuinCnt:function(e){
var t=[];
return e.forEach(function(e){
var n=e.biz_info.name;
-1===t.indexOf(n)&&t.push(n);
}),t.length;
}(e.mpMsgs),
IfSubscription:1*e.isSubscribed===1?2:1,
NewTagId:e.tagId+"",
ShowTag:e.tagName+"",
InsideTag:e.insideTag+"",
Cate1:e.c1Report+"",
Cate2:e.c2Report+"",
NetworkType:1*e.networkType,
PageType:e.pageType?1*e.pageType:0,
CardID:e.cardId?e.cardId:"",
ExpType:e.expType?e.expType:"",
ExpSessionId:e.expSessionId||""
});
e.actionType&&3===e.eventType&&(t.ActionType=1*e.actionType),a.report(21070,t);
},c=function(e){
a.leaveReport(21070,function(){
var t=new Date;
return _extends({},d,{
EventType:2,
Title:e.tagName+"",
TitleType:1*e.titleType,
ArticleCnt:e.mpMsgs.length,
ItemShowType:1===e.msgType?0:5,
BizuinCnt:function(e){
var t=[];
return e.forEach(function(e){
var n=e.biz_info.name;
-1===t.indexOf(n)&&t.push(n);
}),t.length;
}(e.mpMsgs),
IfSubscription:1*e.isSubscribed===1?2:1,
NewTagId:e.tagId+"",
ShowTag:e.tagName+"",
InsideTag:e.insideTag+"",
Cate1:e.c1Report+"",
Cate2:e.c2Report+"",
NetworkType:1*e.networkType,
StayTime:t-(e.entryTime?e.entryTime:0),
PageType:e.pageType?1*e.pageType:0,
CardID:e.cardId?e.cardId:"",
ExpType:e.expType?e.expType:"",
ExpSessionId:e.expSessionId||""
});
});
},u=function(e){
var t=o.getUrlParamsMap(e.jumpUrl),n=169;
n=e.isTimelinePage?10011:1*e.pageType===197?169:1*window.source,a.report(21071,_extends({},p,{
Title:e.tagName+"",
TitleType:1*e.titleType,
BizUin:t.__biz+"",
MsgId:1*t.mid,
ItemIdx:1*t.idx,
ActionType:1*e.actionType,
Pos:1*e.pos,
SendTimeStamp:1*e.sendTime,
IsReaded:1*e.isReaded===0?1:2,
ItemShowType:1*e.itemShowType,
PV:1*e.pv,
Like:1*e.likeCnt,
FriendReaded:1*e.friendReaded,
FriendComment:1*e.friendComment,
IfTopComment:1*e.ifTopComment,
CommentText:e.topCommentText+"",
CommentLength:1*e.topCommentLength,
IfSubscription:1*e.isSubscribed===1?2:1,
NewTagId:e.tagId+"",
ShowTag:e.showTag+"",
InsideTag:e.insideTag+"",
Cate1:e.c1+"",
Cate2:e.c2+"",
Vid:e.vid?e.vid+"":"",
AutoPlay:1*e.canAutoPlay,
StartTime:e.startTime?1*e.startTime:0,
EndTime:e.endTime?1*e.endTime:0,
PlayDuration:e.playDuration?1*e.playDuration:0,
VideoDuration:e.videoDuration?1*e.videoDuration:0,
BuffDuration:e.buffDuration?1*e.buffDuration:0,
PageType:e.pageType?1*e.pageType:0,
RelatedTagID:e.relatedTagId?e.relatedTagId+"":"",
RelatedTagShowTag:e.relatedTagName?e.relatedTagName+"":"",
RelatedTagClickPosition:e.relatedTagClickPos?1*e.relatedTagClickPos:0,
RelatedTagRecInfo:e.relatedTagRecInfo||"",
RelatedTagReloadInfo:e.relatedTagReloadInfo||"",
CardID:e.cardId?e.cardId:"",
ExpType:e.expType?e.expType:"",
Scene:e.scene?1*e.scene:1*window.source,
Subscene:n,
recinfo:(i(e.recInfo)?JSON.stringify(e.recInfo):e.recInfo)||"",
ExpSessionId:e.expSessionId||"",
ItemType:e.itemType||0,
RecReason:e.recReason||"",
FinderFeedObjectId:e.finderFeedObjectId||"",
ExpoTimeLineNames:e.expoTimeLineNames||"",
ExpoTimeLineIds:e.expoTimeLineIds||"",
EventId:e.eventId?e.eventId+"":"",
TimeLineNames:e.timeLineNames||"",
TimeLineIds:e.timeLineIds||""
}));
};
n.exports={
report19649:s,
report21070:T,
leaveReport21070:c,
report21071:u
};
});define("biz_wap/jsapi/leaveReport.js",["biz_wap/utils/ajax.js","biz_wap/jsapi/core.js","biz_common/utils/url/parse.js","biz_wap/utils/log.js"],function(e){
"use strict";
function t(e){
var t={};
return"undefined"!=typeof uin&&(t.uin=uin),"undefined"!=typeof key&&(t.key=key),
"undefined"!=typeof pass_ticket&&(t.pass_ticket=pass_ticket),"undefined"!=typeof wxtoken&&(t.wxtoken=wxtoken),
"undefined"!=typeof window.devicetype&&(t.devicetype=window.devicetype),"undefined"!=typeof window.clientversion&&(t.clientversion=window.clientversion),
"undefined"!=typeof appmsg_token?t.appmsg_token=appmsg_token:e.indexOf("advertisement_report")>-1&&((new Image).src=location.protocol+"//mp.weixin.qq.com/mp/jsmonitor?idkey=68064_13_1&r="+Math.random()),
t.x5=l?"1":"0",t.f="json",f.join(e,t);
}
function o(e){
return e&&"object"==typeof e;
}
function n(e,t){
if(o(e)&&o(t))for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);
}
function r(e){
u("[leaveReport 1]"),console.log("[leaveReport 1]");
var r={};
for(var i in y){
r[i]||(r[i]={});
for(var a=0;a<y[i].length;a++){
var p=y[i][a];
"function"==typeof p?n(r[i],p(e)):o(p)&&n(r[i],p);
}
}
u("[leaveReport getDataFunc.length "+_.length+"]"),console.log("[leaveReport getDataFunc.length "+_.length+"]");
for(var a=0;a<_.length;a++){
var s=_[a](e);
o(s)&&g.push(s);
}
for(var a=0;a<g.length;a++)g[a].reportUrl&&(g[a].reportUrl=t(g[a].reportUrl));
return r.data={
requestList:g
},r;
}
function i(e){
"function"==typeof e?_.push(e):o(e)&&g.push(e);
}
function a(e,t){
y[e]||(y[e]=[]),y[e].push(t);
}
function p(e){
var t=r(!0);
c.invoke("handleMPPageAction",{
action:"reportByLeaveForMPGateway",
reportData:t
},function(o){
if(o&&o.err_msg&&-1!==o.err_msg.indexOf(":ok"))_=[],g=[],y={},"function"==typeof e&&e(o);else{
_=[],g=[];
var n=t.data.requestList.length;
t.data.requestList.forEach(function(t){
t.reportUrl&&s({
type:t.method||"GET",
url:t.reportUrl,
data:t.reportData,
async:!1,
success:function(t){
--n<0&&"function"==typeof e&&e({
err_msg:"handleMPPageAction:ok",
fallback:!0,
resp:t
});
},
error:function(t,o){
--n<0&&"function"==typeof e&&e({
err_msg:"handleMPPageAction:fail",
fallback:!0,
err:o
});
}
});
});
}
});
}
var s=e("biz_wap/utils/ajax.js"),c=e("biz_wap/jsapi/core.js"),f=e("biz_common/utils/url/parse.js"),u=e("biz_wap/utils/log.js"),l=-1!=navigator.userAgent.indexOf("TBS/"),d={},v=!1;
try{
d=top.window.document;
}catch(w){
v=!0;
}
if(!v&&top.window.__leaveReport)return top.window.__leaveReport;
if(window.__leaveReport)return window.__leaveReport;
var _=[],g=[],y={};
c.on("reportOnLeaveForMP",function(){
return r(!1);
});
var h={
reportNow:p,
addReport:i,
addSpecificReport:a
};
return window.__leaveReport=h,h;
});function _classCallCheck(e,a){
if(!(e instanceof a))throw new TypeError("Cannot call a class as a function");
}
var _createClass=function(){
function e(e,a){
for(var t=0;t<a.length;t++){
var s=a[t];
s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s);
}
}
return function(a,t,s){
return t&&e(a.prototype,t),s&&e(a,s),a;
};
}();
define("pages/modules/related_tag/related_tag.js",["pages/modules/related_tag/related_tag.html.js","biz_common/tmpl.js","biz_common/dom/class.js","biz_common/dom/event.js","biz_wap/utils/ajax.js","pages/utils.js","pages/modules/feedback/feedback.js","pages/modules/tag_report/tag_report.js","biz_common/utils/string/html.js"],function(e,a,t){
"use strict";
var s=e("pages/modules/related_tag/related_tag.html.js"),r=e("biz_common/tmpl.js"),i=e("biz_common/dom/class.js"),n=e("biz_common/dom/event.js"),o=e("biz_wap/utils/ajax.js"),l=e("pages/utils.js"),d=e("pages/modules/feedback/feedback.js"),c=e("pages/modules/tag_report/tag_report.js"),g=c.report21071;
e("biz_common/utils/string/html.js");
var p=function(){
function e(a){
_classCallCheck(this,e),this.container=a.container,this.relaPos=a.relaPos,this.data=a.tagData,
this.relatedTagList=a.tagData.relatedTags,this.feedbackOpts=a.tagData.relatedTagsFeedback,
this.unlikeBuffer=a.tagData.unlikeBuffer,this.urlParams=a.urlParams,this.container.innerHTML=r.tmpl(s,{
relatedTagList:this.relatedTagList
}),this.dom={
relatedTagContainer:this.container.querySelector(".js_related_tag_list"),
relatedTagList:this.container.querySelectorAll(".js_related_tag_item"),
feedbackContainer:this.container.querySelector(".js_feedback")
},new d({
container:this.dom.feedbackContainer,
feedbackOpts:this.feedbackOpts,
feedbackCb:this.feedbackCb.bind(this)
}),this.bindEvent();
}
return _createClass(e,[{
key:"feedbackCb",
value:function(e){
var a=this;
o({
type:"GET",
url:"/mp/recommendtag?action=feedback&neg_feedback_type="+JSON.stringify(e)+"&unlike_buffer="+JSON.stringify(this.unlikeBuffer),
timeout:5e3,
dataType:"json",
success:function(e){
var t=e&&e.base_resp&&1*e.base_resp.ret;
switch(t){
case 0:
a.container.previousElementSibling&&i.hasClass(a.container.previousElementSibling,"no_line")&&i.removeClass(a.container.previousElementSibling,"no_line"),
a.container.parentNode.removeChild(a.container);
break;

default:
window.weui.alert("系统繁忙，请稍后再试");
}
},
error:function(){
window.weui.alert("系统繁忙，请稍后再试");
}
});
}
},{
key:"bindEvent",
value:function(){
var e=this,a=l.throttle(this.pageScroll,200).bind(this);
n.tap(this.dom.relatedTagContainer,function(a){
var t=a.target;
if(t.classList.contains("js_related_tag_item")){
var s=t.dataset,r=s.idx,i=s.jump_url,n=s.tag_id,o=l.getUrlParamsMap(i);
l.goUrl(i.html()),g({
actionType:5,
jumpUrl:i,
pos:e.relaPos,
isSubscribed:e.data.isSubscribed,
tagId:e.data.tagId,
showTag:e.data.tagName,
insideTag:e.data.insideTag,
c1:e.data.c1Report,
c2:e.data.c2Report,
tagName:e.data.tagName,
titleType:e.data.title_type,
pageType:e.data.pageType,
cardId:e.urlParams.cardid,
expType:e.urlParams.exptype,
expSessionId:e.urlParams.expsessionid,
scene:o.scene,
relatedTagId:n,
relatedTagName:e.relatedTagList[r].tagName,
relatedTagClickPos:r+1,
relatedTagRecInfo:e.relatedTagList[r].recInfo,
relatedTagReloadInfo:e.relatedTagList[r].reloadInfo
});
}
a.stopPropagation();
}),n.on(window,"scroll",a);
}
},{
key:"checkRelatedTagExposedStatus",
value:function(){
var e=this;
this.dom.relatedTagList.forEach(function(a,t){
if(!a.isExposed&&l.checkExposedStatus(a,.5)){
a.isExposed=!0;
var s=a.dataset,r=s.tag_id,i=s.jump_url,n=l.getUrlParamsMap(i);
g({
actionType:4,
jumpUrl:i,
pos:e.relaPos,
isSubscribed:e.data.isSubscribed,
tagId:e.data.tagId,
showTag:e.data.tagName,
insideTag:e.data.insideTag,
c1:e.data.c1Report,
c2:e.data.c2Report,
tagName:e.data.tagName,
titleType:e.data.title_type,
pageType:e.data.pageType,
cardId:e.urlParams.cardid,
expType:e.urlParams.exptype,
expSessionId:e.urlParams.expsessionid,
scene:n.scene,
relatedTagId:r,
relatedTagName:e.relatedTagList[t].tagName,
relatedTagClickPos:t+1,
relatedTagRecInfo:e.relatedTagList[t].recInfo,
relatedTagReloadInfo:e.relatedTagList[t].reloadInfo
});
}
});
}
},{
key:"pageScroll",
value:function(){
this.checkRelatedTagExposedStatus();
}
}]),e;
}();
t.exports=p;
});function _classCallCheck(t,n){
if(!(t instanceof n))throw new TypeError("Cannot call a class as a function");
}
var _createClass=function(){
function t(t,n){
for(var e=0;e<n.length;e++){
var i=n[e];
i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i);
}
}
return function(n,e,i){
return e&&t(n.prototype,e),i&&t(n,i),n;
};
}();
define("appmsg/emotion/emotion.js",["appmsg/emotion/weemoji.js","icon/emotion_panel/weemoji_panel.css","appmsg/emotion/dom.js","appmsg/emotion/slide.js","appmsg/emotion/common.js","appmsg/emotion/nav.js","appmsg/emotion/textarea.js","biz_common/dom/class.js","biz_common/tmpl.js","appmsg/emotion/emotion.html.js"],function(t){
"use strict";
var n=t("appmsg/emotion/weemoji.js");
t("icon/emotion_panel/weemoji_panel.css");
for(var e=t("appmsg/emotion/dom.js"),i=t("appmsg/emotion/slide.js"),o=t("appmsg/emotion/common.js"),s=t("appmsg/emotion/nav.js"),a=t("appmsg/emotion/textarea.js"),m=(n.EmojiData||[],
n.EmojiPanelData||[]),p=t("biz_common/dom/class.js"),h=t("biz_common/tmpl.js"),r=t("appmsg/emotion/emotion.html.js"),l=(n.EmojiDataMap||[],
[]),u=15,c=o.EMOTIONS_COUNT,d=o.EMOTION_LI_SIZE,g=0;g<m.length;g++)l.push(m[g].style);
var v=function(){
function t(n){
_classCallCheck(this,t),this.opt=n,this.pannel=n.emotionPanel,this.isPannelShow=!1,
this.navs=[],this.listenTogglePannel(),this.buildEmotions(n),this.slide=new i({
emotionSlideWrapper:n.emotionSlideWrapper,
commonWidth:this.width,
pageCount:this.pageCount,
wrapperWidth:this.wrapperWidth,
navs:this.navs
}),s.activeNav(0,this.navs),this.listenClickOnEmotion(),this.textarea=new a({
inputArea:this.opt.inputArea,
submitBtn:this.opt.submitBtn
});
}
return _createClass(t,[{
key:"listenTogglePannel",
value:function(){
var t=this,n=this.opt.inputArea,i=n.el[0],o=this.opt.emotionPanelArrowWrp,s=this.opt.emotionSwitcher,a="emotion_switch_current";
this.pannel.hide();
var m=function(){
o.show(),t.pannel.show(),i.blur(),e.later(function(){
i.blur();
});
},h=function(){
o.hide(),t.pannel.hide(),i.focus(),e.later(function(){
i.focus();
});
};
s.on("tap",function(n){
n.preventDefault(),n.stopPropagation(),t.isPannelShow=!t.isPannelShow,t.isPannelShow?(m(),
s.each(function(t){
p.addClass(t,a);
})):(h(),s.each(function(t){
p.removeClass(t,a);
}));
}),n.on("tap",function(){
t.pannel.hide(),t.isPannelShow=!1;
});
}
},{
key:"setOuterDivWidth",
value:function(){
this.wrapperWidth=this.pageCount*this.width,this.opt.emotionSlideWrapper.css({
width:this.wrapperWidth+"px"
});
}
},{
key:"generateEmotionListAndAppend",
value:function(){
this.opt.emotionSlideWrapper.el[0].insertAdjacentHTML("beforeend",h.tmpl(r,{
pageCount:this.pageCount,
onePageCount:this.emotionsCountOnePage,
emotionsCount:c,
emotionSize:o.EMOTION_SIZE,
emotionLiSize:d,
width:this.width,
gap:(this.width-this.emotionsOneLine*d)/2
},!1));
}
},{
key:"getPageCount",
value:function(){
var t=this.width-2*u;
this.emotionsOneLine=parseInt(t/d,10),this.emotionsCountOnePage=3*this.emotionsOneLine-1;
var n=parseInt(c/this.emotionsCountOnePage,10);
return c%this.emotionsCountOnePage!==0&&n++,n;
}
},{
key:"genrateNavs",
value:function(){
for(var t=0,n=this.pageCount;n>t;t++){
var i=e(e.el("li"));
i.attr("class","emotion_nav js_emotion_nav"),this.navs.push(i),this.opt.emotionNavBar.append(i);
}
}
},{
key:"buildEmotions",
value:function(){
this.width=window.innerWidth||document.body.clientWidth,this.pageCount=this.getPageCount(),
this.setOuterDivWidth(),this.generateEmotionListAndAppend(),this.genrateNavs();
}
},{
key:"hidePannel",
value:function(){
this.pannel.hide();
}
},{
key:"addEmotion",
value:function(t){
if(!this.slide.isMoved){
var n=e(t.currentTarget),i=+n.attr("data-index");
this.textarea.inputEmotion(i),this.opt.inputEmotion&&this.opt.inputEmotion();
}
}
},{
key:"listenClickOnEmotion",
value:function(){
e("li.js_emotion_item").on("click",this.addEmotion.bind(this)),e("li.js_emotion_item").on("touchend",this.addEmotion.bind(this));
}
}]),t;
}();
return{
Emotion:v,
encode:n.decode
};
});var _extends=Object.assign||function(e){
for(var t=1;t<arguments.length;t++){
var i=arguments[t];
for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);
}
return e;
};
define("pages/qq_video_info.js",["biz_wap/zepto/zepto.js","biz_wap/zepto/event.js","biz_wap/zepto/touch.js","biz_wap/ui/weui.js","biz_common/utils/string/html.js","a/a_utils.js","appmsg/without_iframe/iframe_communicate.js","pages/iframe_communicate.js","biz_wap/jsapi/core.js","biz_wap/utils/mmversion.js","biz_common/utils/url/parse.js","biz_wap/utils/ajax.js","pages/loadscript.js","pages/video_plugin/video_monitor.js","biz_wap/utils/localstorage.js","biz_wap/utils/storage.js","pages/version4video.js","biz_common/dom/event.js","pages/report.js","new_video/plugin/proxy.js","new_video/plugin/ad.js","new_video/plugin/danmu.js","new_video/player.js","new_video/ctl.js","biz_common/tmpl.js","pages/video_error.html.js","pages/create_txv.js","biz_wap/utils/jsmonitor_report.js","biz_wap/jsapi/leaveReport.js","biz_wap/jsapi/log.js","page/pages/video_new.css"],function(e){
"use strict";
function t(){
return new Promise(function(e){
D.invoke("getNetworkType",{},function(t){
e(t),Q.networkType=K[t.err_msg]||"fail",("network_type:edge"==t.err_msg||"network_type:wwan"==t.err_msg)&&(t.detailtype||t.subtype)&&(Q.networkType=t.detailtype||t.subtype);
});
});
}
function i(){
U.on(window,"load",function(){
if(window.__wxjs_is_wkwebview){
Q.videoDataLs=new C("video_report_11949");
var e=Q.videoDataLs.getData();
for(var t in e){
var i=+new Date;
i-(e[t].exp-Q.videoDataLsExpTime)>6e4&&(V.videoreport({
data:e[t].val,
async:!0
}),Q.videoDataLs.remove(t));
}
Q.neeedTimoutSaveReportData=!0;
}else Q.neeedTimoutSaveReportData=!1;
});
var e=function(){
if(!Q.hasLeaveReport){
Q.hasLeaveReport=!0;
for(var e=0;e<Q.videoInstance.length;e++){
var t=Q.videoInstance[e];
t.mpVideoReport(),t.destroy();
}
}
};
window.top===window&&G.addReport(e),window.top===window&&G.addSpecificReport("native_data",function(){
var e=Q.videoInstance[0];
return e?{
video_data:{
vid:e._o.vid,
lastPlayedTime:e._g.myPlayer&&e._g.myPlayer.getCurTime(),
lastPlayedTimeExpiredTime:(Date.now()+Q.cacheTime)/1e3
}
}:{};
}),U.on(window,"unload",e);
}
function o(e){
var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];
this._o={
bizUserName:"",
bizNickName:"",
videoTitle:"",
headImgUrl:"",
jsapiFullScreen:!0,
canShareVideo:!0,
videoMd5:"",
pauseShowControll:!0,
preview:!1,
isInIframe:!1,
fromid:0,
ori_status:3,
is_mp_video:0,
plugins:[],
oriVid:"",
vid:"",
ckey:"",
ckey_ad:"",
width:0,
height:0,
container:"",
autoplay:!1,
loop:!1,
resume:Q.resume,
__biz:"",
uin:"",
mid:"",
idx:"",
comment_id:"",
scene_type:0,
hit_bizuin:"",
hit_vid:"",
totalRange:10,
noAd:!1,
isVideoSharePage:!1,
useWcSlPlayer:!1,
useDanmu:!1,
auto:{
loadRetryTime:0,
isShowTip:!1,
isChangeAuto:!1,
isShowSuc:!1
},
onReady:function(){},
onUserplay:function(){}
},this.cgiData=_extends({},window.cgiData,t),w(this._o,e),(!Q.isWechat||!Q.isIOS&&!Q.isAndroid||Q.isIOS&&I.ltVersion("7.0.9",!1)||Q.isAndroid&&I.ltVersion("7.0.10",!1)||I.isInMiniProgram||!this._o.videoMd5)&&(this._o.jsapiFullScreen=!1,
this._o.canShareVideo=!1),this._o.is_mp_video||this._o.useWcSlPlayer||(this._o.pauseShowControll=!1),
!this._o.headImgUrl&&this._o.jsapiFullScreen&&Q.isAndroid&&(this._o.headImgUrl="http://mmbiz.qpic.cn/mmbiz/a5icZrUmbV8p5jb6RZ8aYfjfS2AVle8URwBt8QIu6XbGewB9wiaWYWkPwq4R7pfdsFibuLkic16UcxDSNYtB8HnC1Q/0"),
this._o.oriVid=this._o.oriVid||this._o.vid,1!=this._o.ori_status&&2!=this._o.ori_status&&(this._o.ori_status=3),
this._init({
noProxy:this._o.useWcSlPlayer
}),"number"==typeof this._o.leaveReport12710Type&&this._leaveReport12710();
}
function r(e){
function t(o){
var r=Math.floor(Math.max(o.width,o.height));
if(r>3841)switch(1*o.format_id){
case 10002:
o=e.url_info[i["480p"].index],H.setSum(27302,6,1),t(o);
break;

case 10003:
o=e.url_info[i["270p"].index],H.setSum(27302,7,1);
}
return o;
}
for(var i={},o=0;o<e.url_info.length;o++){
var r=e.url_info[o];
switch(1*r.format_id){
case 20003:
Q.isWechat&&Q.isAndroid&&I.gtVersion("7.0.16",1)&&(i["1080p"]={
index:o
});
break;

case 10002:
i["720p"]={
index:o
};
break;

case 10003:
i["480p"]={
index:o
};
break;

case 10004:
i["270p"]={
index:o
};
}
}
var a=void 0;
if(Q.playerStatus&&Q.playerStatus.formatId&&1*e.is_mp_video_urgent_state!==1)switch(1*Q.playerStatus.formatId){
case 10002:
i["720p"]&&(a=e.url_info[i["720p"].index]);
break;

case 10003:
i["480p"]&&(a=e.url_info[i["480p"].index]);
break;

case 10004:
i["270p"]&&(a=e.url_info[i["270p"].index]);
}
a||(1*e.is_mp_video_urgent_state===1?i["270p"]?a=e.url_info[i["270p"].index]:i["480p"]&&(a=e.url_info[i["480p"].index]):Q.isPc||"wifi"==Q.networkType?i["720p"]?a=e.url_info[i["720p"].index]:i["480p"]&&(a=e.url_info[i["480p"].index]):i["480p"]?a=e.url_info[i["480p"].index]:i["720p"]&&(a=e.url_info[i["720p"].index])),
a||(a=e.url_info[0]),a=t(a);
var n=Math.floor(a.duration_ms/1e3),s=(parseFloat(a.filesize)/1024/1024).toFixed(2),d=window.biz;
d||window.cgiData&&window.cgiData.__biz&&(d=window.cgiData.__biz);
var _=a.url.replace(/^http(s?):/,location.protocol);
return{
formatid:a.format_id,
time:n,
title:a.title||"",
width:a.width,
height:a.height,
file_size:a.filesize,
totalUrl:_+"&spec_id="+encodeURIComponent(d)+parseInt(+new Date/1e3,10),
rate:Math.round(a.filesize/1024*8/n),
flow:s,
ori_url_info:e.url_info.map(function(e){
return _extends({},e,{
url:e.url.replace(/^http(s?):/,location.protocol)
});
})
};
}
function a(e){
function t(){
S({
type:"GET",
dataType:"json",
timeout:3e4,
url:_,
success:function(e){
if(e&&e.base_resp&&0==e.base_resp.ret){
var t="",i=void 0;
if(e.is_mp_video_delete?(t="该视频已被发布者删除",i=72):e.is_mp_video_forbid?(t="该视频因违规已下架",
i=73):1*e.is_mp_video_transing===1?(t="正在转码，转码完成后可播放",i=78):e.is_mp_video_checking?(t="审核中",
i=75):e.is_mp_video_check_fail?(t="审核失败",i=76):1*e.is_appmsg_unauthorized===1&&(t="该视频因未经授权使用而无法查看",
i=77),t&&"undefined"!=typeof i)return void a({
err_msg:t,
code:i
});
if(e.url_info&&e.url_info.length>0)return void o({
data:r(e)
});
a({
err_msg:N,
code:71
});
}else a({
err_msg:"当前视频不存在，暂无法观看",
code:74
});
},
error:function(e){
var t=void 0;
t=e?e.status>=200&&e.status<400?81:e.status>=400&&e.status<500?82:e.status>=500&&e.status<600?83:0==e.status&&4==e.readyState?84:85:80,
a({
err_msg:N,
code:t
});
}
});
}
var i=e.retry||1,o="function"==typeof e.onSuccess?e.onSuccess:function(){},a=function(o){
return o&&o.code>=80&&o.code<=85&&i>0?(i--,void t()):void("function"==typeof e.onError&&e.onError(o));
},s=top.window.location.search.match(/token=([^&]*)/),d=s?s[1]:"",_=["/cgi-bin/video?action=get_mp_video_play_url","&vid=",e.vid,"&token=",d].join("");
return d?void n(t):void a({
err_msg:"当前视频不存在，暂无法观看",
code:79
});
}
function n(e){
window.networkType||Q.networkType||Q.isPc?e():Y?D.invoke("getNetworkType",{},function(t){
Q.networkType=K[t.err_msg]||"fail",("network_type:edge"==t.err_msg||"network_type:wwan"==t.err_msg)&&(t.detailtype||t.subtype)&&(Q.networkType=t.detailtype||t.subtype),
e();
}):e();
}
function s(e){
function t(){
M({
url:i,
timeout:3e4,
callbackName:"video_dynamic_callback",
callback:function(t){
var i=+new Date,r=i-o;
t=t||{},"undefined"==typeof t.em&&(t.em=0);
var a=t.em,n=void 0;
if(!R.getQuery("channel_session_id")||61!==t.em&&62!==t.em||S({
type:"POST",
dataType:"json",
timeout:3e4,
url:"/mp/videochannel_profile_page",
data:{
action:"report_tx_video",
vid:e.vid,
status:t.em
},
success:function(e){
console.log(e);
}
}),0==t.em){
if(t.exem>0?a=-4:0==t.exem&&t.vl&&t.vl.vi&&t.vl.vi[0]&&8==t.vl.vi[0].st&&(a=t.preview>0?-5:-3),
0!=a||t.vl&&t.vl.vi&&t.vl.vi[0]||(a=-2),0==a){
var s=t.vl.vi[0];
if(n={
newVid:s.lnk,
time:Math.floor(s.td),
title:s.ti,
width:s.vw,
height:s.vh,
file_size:s.fs,
rate:Math.round(s.fs/1024*8/s.td),
flow:(parseFloat(s.fs)/1024/1024).toFixed(2)
},s.ul&&s.ul.ui&&s.ul.ui[0]){
var _=s.ul.ui[0],c=_.url+s.fn,p=t.fl,g="";
if(p&&p.cnt>0){
for(var u=p.fi,l={},h=0;h<u.length;h++){
var v=u[h];
switch(v.name){
case"msd":
l["270P"]={
index:h
};
break;

case"mp4":
l["480p"]={
index:h
};
}
var f;
Q.isPc||"wifi"==Q.networkType?l["480p"]?f=u[l["480p"].index]:l["270P"]&&(f=u[l["270P"].index]):l["270P"]?f=u[l["270P"].index]:l["480p"]&&(f=u[l["480p"].index]),
f||(f=u[0]),n.formatid=f.id,g=f.name,n.resolution=(f.cname||"").replace(/^.*;\((:?.*)P\)$/,"$1")||0;
}
n.format=g,n.vt=_.vt,n.totalUrl=[c,-1!=c.indexOf("?")?"&":"?","vkey=",s.fvkey,"&sdtfrom=",V.getsdtfrom(),"&type=",1==_.dt?"tflv":2==_.dt||0==_.dt?"mp4":"","&platform=",V.getPlatformType(),"&fmt=",g,"&level=",s.level,"&br=",s.br,"&sp=",s.sp].join("");
}else a=-2;
}
}
0==a?(V.getinfoReport({
vid:e.vid,
val:r,
val1:a,
vurl:n.totalUrl
}),e.onSuc({
data:n,
oriData:t,
c_time:r,
ret_code:a
})):(V.getinfoReport({
vid:e.vid,
val:r,
val1:a,
vurl:""
}),e.onError(-2,{
ret_code:a,
c_time:r,
err_msg:d(1*a,1*t.exem,t)
}));
}else e.onError(a,{
ret_code:a,
c_time:r,
err_msg:d(a)
});
},
onerror:function(t){
var i=void 0,r=+new Date,a=r-o;
switch(1*t){
case 400:
i=-22;
break;

case 500:
i=-21;
break;

default:
i=-23;
}
"function"==typeof e.onError&&e.onError(i,{
ret_code:i,
c_time:a,
err_msg:d(-1)
}),V.getinfoReport({
vid:e.vid,
val:a,
val1:i,
vurl:""
});
}
});
}
var i="https://h5vv6.video.qq.com/getvinfo?vid=#vid#&dtype=1&otype=json&callback=video_dynamic_callback&appVer=1&encryptVer=6.3&platform=61001&cKey=#ckey#&sdtfrom=#sdtfrom#";
i=i.replace("#vid#",e.vid).replace("#ckey#",e.ckey).replace("#sdtfrom#",V.getsdtfrom()),
i=i+"&device="+V.getPlatformType()+"&use_proxy_sdk="+(z.isUseProxy()?1:0);
var o=+new Date;
n(t);
}
function d(e,t){
var i="";
switch(1*e){
case-4:
i="因版权限制，该视频不支持播放";
break;

case-5:
i="因版权限制，该视频不支持播放";
break;

case-3:
i="因版权限制，该视频不支持播放";
break;

case 61:
i="当前视频不存在，暂无法观看";
break;

case 62:
i="当前视频已下架，暂无法观看";
break;

case 63:
i="视频加载失败，暂无法观看";
break;

case 65:
i="视频加载失败，暂无法观看";
break;

case 67:
i="视频加载失败，暂无法观看";
break;

case 69:
i="视频格式不支持移动端观看，请在电脑上观看";
break;

case 71:
i="视频加载失败，暂无法观看";
break;

case 73:
i="视频加载失败，暂无法观看";
break;

case 74:
i="视频加载失败，暂无法观看";
break;

case 80:
switch(1*t){
case 1:
i="很抱歉，当前IP地址所在地区暂不支持播放";
break;

case 2:
i="因版权限制，暂不支持播放";
break;

default:
i="因版权限制，该视频不支持播放";
}
break;

case 81:
i="视频加载失败，暂无法观看";
break;

case 82:
i="视频加载失败，暂无法观看";
break;

case 83:
switch(1*t){
case-1:
i=N;
break;

case-2:
i="因版权限制，该视频不支持播放";
break;

default:
i="该片为付费视频，请前往腾讯视频观看";
}
break;

case 84:
i="很抱歉，根据您的IP地址，暂无法播放";
break;

default:
i=N;
}
return i;
}
function _(e){
var t="https://h5vv.video.qq.com/getextinfo?otype=json&callback=video_static_callback&vid="+e.vid;
M({
url:t,
timeout:3e4,
callbackName:"video_static_callback",
callback:function(t){
if(!t||"o"!=t.s||t.vl.cnt<=0)return void("function"==typeof e.onError&&e.onError(-1));
var i=t.vl.vi[0],o={
title:i.title||"视频",
desc:1*i.desc===0?"":i.desc||"",
director:i.director||"",
leading_actor:i.leading_actor||"",
costar:i.costar||"",
time:Math.floor(i.td)||0
};
if(i.pl&&i.pl.cnt>0){
var r=i.pl.pi;
o.p400_300=r[0]?r[0].url:"",o.p140_100=r[1]?r[1].url:"",o.p120_90=r[2]?r[2].url:"",
o.p400_300=o.p400_300&&-1==o.p400_300.indexOf("http")?"http://"+o.p400_300:o.p400_300,
o.p140_100=o.p140_100&&-1==o.p140_100.indexOf("http")?"http://"+o.p140_100:o.p140_100,
o.p120_90=o.p120_90&&-1==o.p120_90.indexOf("http")?"http://"+o.p120_90:o.p120_90;
}
e.onSuc(o);
},
onerror:function(t){
"function"==typeof e.onError&&e.onError(t);
}
});
}
function c(e){
for(var t=1e8,i=0,o=0,r=e.length;r>o;o++)i=(i<<5)+i+e.charCodeAt(o);
return i%t;
}
function p(e,t,i){
return i?"/mp/videoplayer?action=get_mp_video_cover&vid="+e:location.protocol+"//puui.qpic.cn/vpic_cover/"+e+"/"+e+"_hz.jpg";
}
function g(e,t,i,o){
var r=x.get(Q.cachekey+o);
if(!r)return null;
try{
if(r=JSON.parse(r)||{},!r.time||Date.now()-Q.cacheTime>1*r.time)return f(o),r.videoInfo={
status:u(e,t,i,o)
},r;
}catch(a){
return f(o),null;
}
return r=r.videoInfo?r:{
videoInfo:{}
},r.videoInfo.status=u(e,t,i,o),r.videoInfo?r:null;
}
function u(e,t,i,o){
var r=x.get(Q.cachekey+e+t+i+o);
if(!r)return null;
try{
r=JSON.parse(r)||{};
}catch(a){
return m(e,t,i,o),null;
}
return r;
}
function l(){
var e=x.get(Q.cachekey+"playerStatus");
if(e){
try{
e=JSON.parse(e)||{};
}catch(t){
return void f("playerStatus");
}
e.playerStatus&&(Q.playerStatus=e.playerStatus,console.log("get player status cache",Q.playerStatus));
}
}
function h(e,t,i,o,r,a){
var n={
dynamicData:r.dynamicData||null,
coverUrl:r.coverUrl||""
};
x.set(Q.cachekey+o,JSON.stringify({
time:a||Date.now(),
videoInfo:n
})),r.status&&x.set(Q.cachekey+e+t+i+o,JSON.stringify(r.status));
}
function v(){
x.set(Q.cachekey+"playerStatus",JSON.stringify({
playerStatus:Q.playerStatus
}));
}
function f(e){
x.remove(Q.cachekey+e);
}
function m(e,t,i,o){
x.remove(Q.cachekey+e+t+i+o);
}
function y(e){
return document.getElementById(e);
}
function w(e,t){
for(var i in t)e[i]=t[i];
}
function b(){
t(),i(),l();
}
var k=window.withoutIframe?window:window.parent.window;
-1!=location.href.indexOf("__td=qq.com")&&(document.domain="qq.com"),e("biz_wap/zepto/zepto.js"),
e("biz_wap/zepto/event.js"),e("biz_wap/zepto/touch.js"),e("biz_wap/ui/weui.js"),
e("biz_common/utils/string/html.js");
var P=e("a/a_utils.js"),T=e(window.withoutIframe?"appmsg/without_iframe/iframe_communicate.js":"pages/iframe_communicate.js"),D=e("biz_wap/jsapi/core.js"),I=e("biz_wap/utils/mmversion.js"),R=e("biz_common/utils/url/parse.js"),S=e("biz_wap/utils/ajax.js"),M=e("pages/loadscript.js"),j=e("pages/video_plugin/video_monitor.js"),x=e("biz_wap/utils/localstorage.js"),C=e("biz_wap/utils/storage.js"),z=e("pages/version4video.js"),U=e("biz_common/dom/event.js"),V=e("pages/report.js"),E=e("new_video/plugin/proxy.js"),L=e("new_video/plugin/ad.js"),O=e("new_video/plugin/danmu.js"),A=e("new_video/player.js"),B=e("new_video/ctl.js"),q=e("biz_common/tmpl.js"),W=e("pages/video_error.html.js"),N="视频加载失败，请刷新页面重试",F=e("pages/create_txv.js"),H=e("biz_wap/utils/jsmonitor_report.js"),G=e("biz_wap/jsapi/leaveReport.js"),J=e("biz_wap/jsapi/log.js"),Q={
isUseProxy:z.isUseProxy(),
isWechat:I.isWechat,
isAndroid:I.isAndroid,
isIOS:I.isIOS,
isGoTx:k.location.href.indexOf("&_gotx=1")>0,
_debug:k.location.href.indexOf("&vconsole=1")>0,
cachekey:"qqmovieStatus_",
videoDataLs:null,
videoDataLsExpTime:864e7,
cacheTime:6e5,
videoInfo:{},
videoInstance:[],
neeedTimoutSaveReportData:!0,
networkType:"",
isPc:/(WindowsNT)|(Windows NT)|(Macintosh)/i.test(navigator.userAgent),
hasLeaveReport:!1,
playerStatus:{
formatId:null
}
},K={
"network_type:fail":"fail",
"network_type:edge":"2g/3g",
"network_type:wwan":"2g/3g",
"network_type:wifi":"wifi"
};
b(),o.prototype._init=function(e){
function i(){
try{
if(window.withoutIframe){
for(var e=k.document.getElementsByClassName("video_iframe"),t=0;t<e.length;t++)if(n._o.vid===e[t].getAttribute("vid")&&e[t].adVidFromAppmsg)return!0;
}else for(var e=k.document.getElementsByTagName("iframe"),t=0;t<e.length;t++)if(window===e[t].contentWindow&&e[t].adVidFromAppmsg||e[t].adVidFromAppmsg===window.realVid&&window.realVid)return!0;
}catch(i){
console.log(i);
}
}
var o=this;
e=e||{},this.destroy(),Q.videoInstance.push(this),this._report=V.getVideoReportData(),
this._g={
gWidth:e.gWidth||this._o.width,
gHeight:e.gHeight||this._o.height,
playRangeInfo:[],
dynamicErrMsg:"",
hasReportProxyError:e.hasReportProxyError===!0,
noProxy:e.noProxy===!0,
hasDestroy:!1,
reportDataTimeoutId:null,
reportDataLsKey:this._o.vid+"_"+Math.random(),
hasReport:!1,
isShowTx:!1,
dataCount:0,
targetDataCount:2,
coverUrl:"",
cacheStartTs:0,
vInfo:{
status:null,
coverUrl:"",
dynamicData:null,
is_report_pv:!1
},
dom:{
page_content:y("page-content"),
js_mpvedio:y("js_mpvedio")
},
initialData:null
},this._getRatio(),this._initPlugins(e),this._initReportData(),this._defineEvent(),
P.report115849(71);
var r=setInterval(function(){
i()&&(P.report115849(75),P.report115849(76),clearInterval(r));
},500);
if(this._isGotoTx()===!0)return void P.report115849(70);
this._getCache(),window.__timelineInitialData?(this._g.initialData=window.__timelineInitialData,
this._setCoverUrl()):this._setCoverUrl(),this._cacheOnPageInvisible();
var a=setInterval(function(){
i()&&(P.report115849(83),P.report115849(84),clearInterval(a));
},500);
this._reportH265VideoSupport();
var n=this;
z.isUseAd()&&this._o.noAd!==!0&&(this._g.myAdPlugin=new L({
fromid:this._o.fromid,
videoReportType:this.getReportTypeBySceneType(),
isMpVideo:n._o.is_mp_video,
vid:this._o.vid,
ratio:this._o.ratio,
oriVid:this._o.oriVid,
tmpGetAd:function(e,t){
s({
vid:"b0163rzlnn7",
ckey:n._o.ckey_ad,
onSuc:function(t){
e&&e(t);
},
onError:function(){
t&&t();
}
});
}
})),this._cacheReportData();
var d=!1;
return"undefined"!=typeof Promise&&(d=!0),this._o.fakePlayer?(this._trigger("setMonitor",this._g.monitorUid2,{
76:1
}),void this._trigger("sendMonitor",this._g.monitorUid2)):void(Q.isWechat&&!Q.networkType&&Q.playerStatus&&!Q.playerStatus.formatId&&d?(t().then(function(){
o._getDynamic();
}).catch(function(){
o._getDynamic();
}),setTimeout(function(){
o.hasInitNetwork||o._getDynamic();
},5e3)):this._getDynamic());
},o.prototype._getRatio=function(){
for(var e=this._o.width/this._o.height,t=[4/3,16/9],i=t[0],o=Math.abs(i-e),r=1,a=t.length;a>r;r++){
var n=Math.abs(t[r]-e);
o>n&&(o=n,i=t[r]);
}
this._o.ratio=i;
},o.prototype._isGotoTx=function(){
var e=this,t=this._o;
if((!t.ckey||Q.isGoTx)&&!t.is_mp_video){
e._g.isShowTx=!0;
var i=$(this._o.container),o=i.attr("id");
o||(o="js_tx_video_container_"+Math.random(),i.attr("id",o)),F.createTxVideo({
win:window,
containerId:o,
vid:t.vid,
width:e._g.gWidth,
height:e._g.gHeight,
autoplay:!1,
allowFullScreen:!0,
onSuccess:function(t){
e._g.txPlayer=t.player,e._g.dataCount=e._g.targetDataCount,e.videoDataReady();
},
onError:function(){}
});
var r=this._g.monitorUid;
if(1==window.is_login)this._trigger("setMonitor",r,{
38:1
});else if(this._trigger("setMonitor",r,{
39:1
}),1===k.is_login){
var a=JSON.stringify({
tag:"video_player_login_status",
uin:window.user_uin,
bizUin:encodeURIComponent(t.__biz),
appmsgBizUin:encodeURIComponent(k.biz),
appmsgUserUin:k.user_uin,
isSecOpen:!!k.__second_open__
});
H.setLogs({
id:115849,
key:73,
value:1,
lc:1,
log0:a
});
}
return this._trigger("sendMonitor",r),!0;
}
return!1;
},o.prototype._reportH265VideoSupport=function(){
var e=this._g.monitorUid2;
this._trigger("setMonitor",e,{
36:1
});
var t=document.createElement("video");
if("function"==typeof t.canPlayType){
var i=t.canPlayType('video/mp4; codecs="hevc"');
("maybe"==i.toLowerCase()||"probably"==i.toLowerCase())&&this._trigger("setMonitor",e,{
37:1
});
}
this._trigger("sendMonitor",e);
},o.prototype._initPlugins=function(){
var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];
if(!e.hasInitPlugins){
var t=this._o.plugins||[];
t.push(new j),this._blockPlugin={};
for(var i=0,o=t.length;o>i;++i){
var r=t[i];
r.setPlayer(this),!!r.init&&r.init();
}
this.plugins=t;
}
},o.prototype.isInFullScreen=function(){
return this._g.myPlayer?this._g.myPlayer.isInFullScreen():!1;
},o.prototype._initReportData=function(){
var e=this._report,t=this._o;
e.mid=t.mid,e.__biz=t.__biz,e.idx=t.idx,e.vid=t.vid,e.commentid=t.comment_id,e.scene_type=t.scene_type,
e.auto_play=t.autoplay?1:0,e.fromid=t.fromid,e.hit_bizuin=t.hit_bizuin,e.hit_vid=t.hit_vid,
this._g.monitorUid=this._trigger("initMonitor",64728),this._g.monitorUid2=this._trigger("initMonitor",110644);
},o.prototype._initPlayRangeInfo=function(e){
function t(e,t){
for(var i=[{
start:0,
end:e,
hasReport:!1
}];;){
var o=i[i.length-1];
if(o.end>=t)break;
i.push({
start:o.end,
end:o.end+e,
hasReport:!1
});
}
return i;
}
if(!(e.durationMs<=0)){
var i=this._o.totalRange;
this._g.playRangeInfo=1e3*i>=e.durationMs?t(1e3,e.durationMs):t(Math.ceil(e.durationMs/i),e.durationMs);
}
},o.prototype._reportCurRangeInfo=function(e){
var t=this._g.playRangeInfo;
if(t&&0!==t.length)for(var i=t.length,o=this._o,r=0;i>r;r++){
var a=t[r];
if(a.start<e.curTime&&a.end>=e.curTime){
a.hasReport||(a.hasReport=!0,B.report({
step:14,
vid:o.vid,
hit_bizuin:o.hit_bizuin,
hit_vid:o.hit_vid,
traceid:this._getTraceId(),
orderid:this._getOrderid(),
ori_status:this._getOriStatus(),
type:this.getReportTypeBySceneType(),
fromid:this._getFromid(),
total_range:i,
current_range:r+1,
duration:this._report.duration_ms||t[i-1].end
}));
break;
}
}
},o.prototype._defineEvent=function(){
var e=this;
this._g.event={
afterRemoveLoading:function(){
e._afterRemoveLoading();
}
};
},o.prototype.videoDataReady=function(){
var e=this;
return this._o.fakePlayer?void this._createFakePlayer():void(this._g.dataCount===this._g.targetDataCount&&(this._g.isShowTx?this._removeLoading():this._g.vInfo.dynamicData?this._createPlayer({
onLoaded:function(){
setTimeout(function(){
e._removeLoading();
},0);
}
}):(this._removeLoading(),J.error("qq_video_info: failed to create player because no dynamic data"))));
},o.prototype._removeLoading=function(){
this._o.isInIframe?(T.addListener({
type:"afterRemoveLoading",
func:this._g.event.afterRemoveLoading,
vid:this._o.oriVid
}),T.postMessage({
type:"removeVideoLoading",
data:{
vid:this._o.oriVid
}
})):this._afterRemoveLoading();
},o.prototype._afterRemoveLoading=function(){
if(!this._g.isShowTx&&!this._g.vInfo.dynamicData)if(this._o.is_mp_video){
var e=1;
(72==this._report.videoerror||73==this._report.videoerror)&&(e=2),this._showError(this._g.dynamicErrMsg,e);
}else this._showError(this._g.dynamicErrMsg||"");
T.removeListener({
type:"afterRemoveLoading",
func:this._g.event.afterRemoveLoading
}),this._bindResize(),this._o.onReady.call(this),this._trigger("videoReady");
},o.prototype._setCoverUrl=function(){
function e(){
S({
type:"GET",
dataType:"json",
timeout:3e4,
url:a,
success:function(e){
e&&e.base_resp&&0==e.base_resp.ret&&e.url&&(i._g.coverUrl=e.url),i._g.dataCount++,
i.videoDataReady();
},
error:r
});
}
var t="";
if(this._g.initialData&&this._g.initialData.initialCover?t=this._g.initialData.initialCover:this._o.is_mp_video&&window.__mpVideoCoverUrl?t=window.__mpVideoCoverUrl:this._g.vInfo.coverUrl&&(t=this._g.vInfo.coverUrl),
t)return this._g.coverUrl=t,this._g.dataCount++,void this.videoDataReady();
if(this._g.coverUrl=this._getCover(),!this._o.is_mp_video)return this._g.dataCount++,
void this.videoDataReady();
var i=this,o=1,r=function(){
return o>0?(o--,void e()):(i._g.dataCount++,void i.videoDataReady());
},a=this._g.coverUrl+"&f=json";
e();
},o.prototype._getDynamic=function(){
var e=this,t=this._o,i=this._g;
if(e.hasInitNetwork=!0,t.is_mp_video&&window.__mpVideoTransInfo&&window.__mpVideoTransInfo.length>0)return i.dataCount++,
i.vInfo.dynamicData={
data:r({
url_info:window.__mpVideoTransInfo.map(function(e){
return e.url=e.url.htmlDecode(),e.url=e.url.replace(/^http(s?):/,location.protocol),
e;
})
})
},void this.videoDataReady();
if(i.vInfo.dynamicData){
i.dataCount++;
var o=i.vInfo.dynamicData;
return this._report.getvinfo_ret="undefined"!=typeof o.ret_code?o.ret_code:-2,this._report.getvinfo_time=o.c_time||0,
t.is_mp_video&&o.data&&o.data.ori_url_info&&o.data.ori_url_info.length>0&&(i.vInfo.dynamicData={
data:r({
url_info:o.data.ori_url_info
})
}),void this.videoDataReady();
}
var n=this._report,d=i.monitorUid,_=i.monitorUid2;
return t.is_mp_video?void a({
preview:t.preview,
vid:t.vid,
__biz:t.__biz,
mid:t.mid,
idx:t.idx,
auto:!(!Q.isAndroid||!I.gtVersion("7.0.16",1)),
onSuccess:function(t){
e._trigger("setMonitor",_,{
93:1,
94:1
}),e._trigger("sendMonitor",_),i.dataCount++,i.vInfo.dynamicData=t,e.videoDataReady();
},
onError:function(t){
switch(e._trigger("setMonitor",_,{
93:1,
95:1
}),1*t.code){
case 80:
e._trigger("setMonitor",_,{
86:1,
92:1
});
break;

case 81:
e._trigger("setMonitor",_,{
86:1,
91:1
});
break;

case 82:
e._trigger("setMonitor",_,{
86:1,
90:1
});
break;

case 83:
e._trigger("setMonitor",_,{
86:1,
89:1
});
break;

case 84:
e._trigger("setMonitor",_,{
86:1,
88:1
});
break;

case 85:
e._trigger("setMonitor",_,{
86:1,
87:1
});
break;

case 71:
e._trigger("setMonitor",_,{
78:1
});
break;

case 72:
e._trigger("setMonitor",_,{
79:1
});
break;

case 73:
e._trigger("setMonitor",_,{
80:1
});
break;

case 74:
e._trigger("setMonitor",_,{
85:1
});
break;

case 75:
e._trigger("setMonitor",_,{
81:1
});
break;

case 76:
e._trigger("setMonitor",_,{
82:1
});
break;

case 79:
e._trigger("setMonitor",_,{
77:1
});
}
e._trigger("sendMonitor",_),n.videoerror=t.code,e._g.dynamicErrMsg=t.err_msg||"",
n.duration_ms=0,i.vInfo.dynamicData=null,e._g.dataCount=e._g.targetDataCount,e.videoDataReady();
}
}):void s({
vid:t.vid,
ckey:t.ckey,
onSuc:function(t){
if(e._trigger("setMonitor",d,{
10:1,
11:1,
13:Math.min(t.c_time,6e4)
}),t.data.width&&t.data.height){
var o=Math.round(10*t.data.width/t.data.height*1);
o>20?o=20:0>o&&(o=0);
var r=41+2*o,a={};
a[r]=1,e._trigger("setMonitor",d,a);
}else e._trigger("setMonitor",d,{
83:1
});
e._trigger("sendMonitor",d),i.dataCount++,i.vInfo.dynamicData=t,n.getvinfo_ret=t.ret_code,
n.getvinfo_time=t.c_time,n.file_size=t.data.file_size,n.rate=t.data.rate,n.resolution=t.data.resolution,
n.format=t.data.format,n.vt=t.data.vt,n.video_ext=V.getsdtfrom(),e.videoDataReady();
},
onError:function(t,o){
if(e._trigger("setMonitor",d,{
10:1,
12:1,
13:Math.min(o.c_time,6e4)
}),-2==t)switch(1*o.ret_code){
case-2:
e._trigger("setMonitor",d,{
17:1
}),n.videoerror=2;
break;

case-3:
e._trigger("setMonitor",d,{
40:1
}),n.videoerror=53;
break;

case-4:
e._trigger("setMonitor",d,{
109:1
}),n.videoerror=54;
break;

case-5:
e._trigger("setMonitor",d,{
110:1
}),n.videoerror=55;
break;

case 61:
e._trigger("setMonitor",d,{
18:1
}),n.videoerror=25;
break;

case 62:
e._trigger("setMonitor",d,{
19:1
}),n.videoerror=26;
break;

case 64:
e._trigger("setMonitor",d,{
20:1
}),n.videoerror=27;
break;

case 67:
e._trigger("setMonitor",d,{
21:1
}),n.videoerror=28;
break;

case 69:
e._trigger("setMonitor",d,{
22:1
}),n.videoerror=52;
break;

case 80:
e._trigger("setMonitor",d,{
23:1
}),n.videoerror=29;
break;

case 81:
e._trigger("setMonitor",d,{
24:1
}),n.videoerror=50;
break;

case 85:
e._trigger("setMonitor",d,{
25:1
}),n.videoerror=51;
break;

default:
e._trigger("setMonitor",d,{
26:1
}),n.videoerror=24;
}else{
switch(1*t){
case-22:
e._trigger("setMonitor",d,{
15:1
});
break;

case-21:
e._trigger("setMonitor",d,{
14:1
});
break;

case-23:
e._trigger("setMonitor",d,{
16:1
});
}
n.videoerror=-1*t;
}
e._trigger("sendMonitor",d),e._g.dynamicErrMsg=o.err_msg||"",n.getvinfo_ret=o.ret_code,
n.duration_ms=0,n.getvinfo_time=o.c_time||0,i.vInfo.dynamicData=null,e._g.dataCount=e._g.targetDataCount,
e.videoDataReady();
}
});
},o.prototype._createFakePlayer=function(){
var t=this._o.container,i=this._g.coverUrl,o=["width: 100%;","height: 100%;","background: center / contain no-repeat black url('"+i+"');"].join(" "),r=['<div class="video_player page_video fake" style="'+o+'">','<div class="full_screen_opr">','<div class="mid_play_box">','<div class="icon_mid_play"></div>',"</div>","</div>","</div>"].join("");
e("page/pages/video_new.css");
var a=$(r);
$(t).append(a);
},o.prototype._createPlayer=function(){
var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this,i=this._g,o=this._o,r=i.vInfo||{},a=this._report,n=r&&r.dynamicData&&r.dynamicData.data||{},s=[];
i.myAdPlugin&&s.push(i.myAdPlugin),i.noProxy!==!0&&Q.isUseProxy&&s.push(new E({
vid:o.vid,
data:n,
cdn_url:n.totalUrl
})),o.useDanmu===!0&&s.push(new O({
bizUin:this.cgiData.biz,
msgId:1*this.cgiData.mid,
idx:1*this.cgiData.idx,
vid:o.vid
})),a.duration_ms=parseInt(1e3*n.time),this._initPlayRangeInfo({
durationMs:a.duration_ms
}),a.vtitle=this.cgiData&&this.cgiData.video_title&&this.cgiData.video_title.htmlDecode()||n.title||"";
var d=!1,_=i.monitorUid,c=i.monitorUid2,p=t.getReportTypeBySceneType(),g=void 0;
n.ori_url_info&&!function(){
var e={
10002:"超清",
10003:"高清",
10004:"流畅",
20003:"自动"
};
g=[],n.ori_url_info.forEach(function(t){
(1*t.format_id!==20003||Q.isWechat&&Q.isAndroid&&I.gtVersion("7.0.16",1))&&g.push({
name:t.video_quality_wording||e[t.format_id],
formatId:t.format_id,
height:t.height,
width:t.width,
src:t.url
});
});
}();
var u=[{
rate:.5,
name:"0.5倍"
},{
rate:.75,
name:"0.75倍"
},{
rate:1,
name:"1.0倍"
},{
rate:1.5,
name:"1.5倍"
},{
rate:2,
name:"2.0倍"
}],l=R.getQuery("play_time"),h=0;
i.initialData?h=i.initialData.initialTime||0:""!==l?h=1*l||0:r.status&&!r.status.isEnd&&(h=r.status.playTime||0),
J.info("qq_video_info: begin to create player"),i.myPlayer=new A({
__biz:o.__biz,
mid:o.mid,
idx:o.idx,
bizUserName:o.bizUserName,
bizNickName:o.bizNickName,
videoTitle:a.vtitle,
videoReportType:p,
defineCSS:!0,
container:o.container,
cover:i.coverUrl,
ratio:o.ratio,
width:i.gWidth,
height:i.gHeight,
videoWidth:n.width,
videoHeight:n.height,
duration:n.time,
autoplay:o.autoplay,
autoReplay:o.autoReplay,
isVideoSharePage:o.isVideoSharePage,
flowNotice:o.flowNotice,
flow:n.flow,
loop:o.loop,
plugins:s,
src:n.totalUrl,
formatId:n.formatid,
headImgUrl:o.headImgUrl,
jsapiFullScreen:o.jsapiFullScreen,
canShareVideo:o.canShareVideo,
pauseShowControll:o.pauseShowControll,
videoMd5:o.videoMd5,
useWcSlPlayer:o.useWcSlPlayer,
initialTime:h,
resolutionInfo:g,
playbackRateInfo:u,
playbackRateBtnInfoDefaultId:2,
cgiData:this.cgiData,
extinfo:{
hit_bizuin:o.hit_bizuin,
hit_vid:o.hit_vid,
vid:o.vid,
preview:o.preview,
pageplayer:t
},
isTLpage:o.isTLpage||!1,
muted:o.muted||!1,
fileSize:n.file_size,
onLoaded:function(){
"function"==typeof e.onLoaded&&e.onLoaded(),J.info("qq_video_info: succ created player");
},
onTimeupdate:function(e,r){
if(!d){
d=!0,B.report({
step:6,
vid:o.vid,
traceid:t._getTraceId(),
orderid:t._getOrderid(),
type:p,
fromid:t._o.fromid
});
var n=this.getLog(),s=n.loadwait||0;
t._qqVideoReport({
step:6,
loadwait:s
});
}
i.is_report_pv||(i.is_report_pv=!0,t._trigger("clearMonitor",_),t._trigger("clearMonitor",c),
t._o.is_mp_video?(t._trigger("setMonitor",c,{
12:1,
13:1
}),t._trigger("sendMonitor",c)):(t._trigger("setMonitor",_,{
0:1,
1:1
}),t._trigger("sendMonitor",_))),a.last_ms=parseInt(1e3*r.currentTime),a.video_play_time=parseInt(1e3*r.currentTime),
t._reportCurRangeInfo({
curTime:a.last_ms
}),t._trigger("timeupdate",r);
},
onBeginPlay:function(){
var e=r.status,i=this;
1*h>0&&1*h<.99*n.time&&(i.play(h),e&&e.playTime&&(e.playTime=0)),a.client_time_when_play=Math.round(+new Date/1e3),
a.click_play_button=1,"string"==typeof o.container&&"#"==o.container.charAt(0)&&"number"==typeof o.__count__&&o.__hasReport===!1&&(0==o.__count__?(new Image).src="/mp/jsreport?key=103&content=video_test&r="+Math.random():1==o.__count__?(new Image).src="/mp/jsreport?key=104&content=video_test&r="+Math.random():o.__count__>=2&&((new Image).src="/mp/jsreport?key=105&content=video_test&r="+Math.random()),
o.__hasReport=!0),t._trigger("beginPlay");
},
onDurationchange:function(){
if(this._useWcSlPlayer()){
var e=r.status;
e&&1*e.playbackRate!==1&&(this.setPlaybackRate(e.playbackRate),e.playbackRate=1);
}
},
onFullscreenchange:function(e,i){
t._trigger("fullscreenchange",i);
},
onAriaReplay:function(){
t._trigger("ariaReplay");
},
onStatusChange:function(e,i){
"loading"!==i.status||"seeked"!==i.subStatus&&"seeking"!==i.subStatus||t._initPlayRangeInfo({
durationMs:a.duration_ms
}),t._trigger("statusChange",i);
},
onAfterReplay:function(){
t._trigger("afterReplay");
},
onHandDragComplete:function(e,i){
t._trigger("handDragComplete",i);
},
onBarDragComplete:function(e,i){
t._trigger("barDragComplete",i);
},
onEnd:function(){
this.hideControllBar(),this.autoChangeTip({
type:"autoChange",
option:"hide"
}),this.autoChangeTip({
type:"autoSuc",
option:"hide"
}),a.hasended=1,B.report({
step:7,
vid:o.vid,
ext1:1e3*n.time,
traceid:t._getTraceId(),
orderid:t._getOrderid(),
type:p,
fromid:t._o.fromid,
duration:a.duration_ms,
cgiData:this.cgiData
}),t._debug("onend isend:"+this.isEnd()),t._trigger("hidePauseTips"),t._trigger("showEndContent"),
t._reportCurRangeInfo({
curTime:a.last_ms
}),t._initPlayRangeInfo({
durationMs:a.duration_ms
}),o.onEnd&&o.onEnd.call(this);
},
onError:function(e,o){
if(a.videoerror=!o||!o.errorcode||o.errorcode>5||o.errorcode<=0?46:o.errorcode+40,
Q.isUseProxy&&!t._g.noProxy?Q.isAndroid?t._trigger("setMonitor",c,{
30:1
}):Q.isIOS&&t._trigger("setMonitor",c,{
32:1
}):Q.isUseProxy&&t._g.noProxy&&!t._g.hasReportProxyError&&(t._g.hasReportProxyError=!0,
Q.isAndroid?t._trigger("setMonitor",c,{
31:1
}):Q.isIOS&&t._trigger("setMonitor",c,{
33:1
})),t._o.is_mp_video){
switch(i.is_report_pv||(i.is_report_pv=!0,t._trigger("setMonitor",c,{
12:1
})),t._trigger("setMonitor",c,{
14:1
}),1*o.errorcode){
case 1:
t._trigger("setMonitor",c,{
15:1
});
break;

case 2:
t._trigger("setMonitor",c,{
16:1
});
break;

case 3:
t._trigger("setMonitor",c,{
17:1
});
break;

case 4:
t._trigger("setMonitor",c,{
18:1
});
break;

case 5:
t._trigger("setMonitor",c,{
19:1
});
break;

case 6:
t._trigger("setMonitor",c,{
39:1
});
break;

default:
t._trigger("setMonitor",c,{
20:1
});
}
t._trigger("sendMonitor",c);
}else{
switch(i.is_report_pv||(i.is_report_pv=!0,t._trigger("setMonitor",_,{
0:1
})),t._trigger("setMonitor",_,{
2:1,
3:1
}),1*o.errorcode){
case 1:
t._trigger("setMonitor",_,{
4:1
});
break;

case 2:
t._trigger("setMonitor",_,{
5:1
});
break;

case 3:
t._trigger("setMonitor",_,{
6:1
});
break;

case 4:
t._trigger("setMonitor",_,{
7:1
});
break;

case 5:
t._trigger("setMonitor",_,{
8:1
});
break;

default:
t._trigger("setMonitor",_,{
9:1
});
}
t._trigger("sendMonitor",_),t._trigger("sendMonitor",c);
}
a.v_err_code=o.errorcode,t._showError(),t._qqVideoReport({
step:1999,
val:a.videoerror
}),t._initPlayRangeInfo({
durationMs:a.duration_ms
});
},
onFirstBufferingTime:function(e,i){
t._trigger("firstBufferingTime",i);
},
onPlayingBufferingTime:function(e,i){
t._trigger("playingBufferingTime",i);
},
onFlowNotice:function(e,i){
t._trigger("flowNotice",i);
},
onUserplay:function(e,i){
t._trigger("userplay",i);
},
onUserpause:function(e,i){
t._trigger("userpause",_extends({
curTime:this.getCurTime()
},i)),a.pause_num=(a.pause_num||0)+1;
},
onWaiting:function(e,o){
if(Q.isWechat&&Q.isAndroid&&I.gtVersion("7.0.16",1)){
var r={
10004:1,
10003:2,
10002:3,
20003:4
},a={
"自动":"20003",
"超清":"10002",
"高清":"10003",
"流畅":"10004"
},n={
WiFI:1,
"2G":2,
"3G":3,
"4G":4
};
o&&!function(){
for(var e=3,s=i.myPlayer,d=s.getResolutionInfo(),_=d?d.src:null,c=t._o.auto.loadRetryTime,p=t._o.auto.isShowTip,g=null,u=5e3,l=$(".js_auto_change_tip_mask")[0],h=void 0,v=void 0,f=i.vInfo.dynamicData?i.vInfo.dynamicData.data.ori_url_info.map(function(e){
var t=e.video_quality_wording,i=a[t];
return{
formatId:i,
src:e.url,
name:t
};
}):[],m=0;m<f.length;m++)"20003"===f[m].formatId&&(h=f[m].src),f[m].src===_&&(v=r[[f[m].formatId]]);
var y=function(e){
var i=$(".js_auto_change_tip")[0];
U.tap(i,function(){
t._o.auto.isChangeAuto=!0,t._trigger("autoTip",{
networkType:networkType,
DefinitionBefore:e.definitionBefore
});
});
},w=function(){
U.on(l,"tap",function(e){
e.cancelBubble=!0,i.myPlayer.autoChangeTip({
type:"autoChange",
option:"hide"
}),s.hideControllBar();
});
},b=function(){
g&&clearTimeout(g),g=setTimeout(function(){
i.myPlayer.autoChangeTip({
type:"autoChange",
option:"hide"
});
},u);
},k=function(){
s.hideControllBar(),i.myPlayer.autoChangeTip({
type:"autoChange",
option:"show"
}),p=!0;
var e=-1;
D.invoke("getNetworkType",{},function(t){
e=n[K[t.err_msg]]||0,("network_type:edge"==t.err_msg||"network_type:wwan"==t.err_msg)&&(t.detailtype||t.subtype)&&(e=n[t.detailtype]||n[t.subtype]);
}),y({
networkType:e,
definitionBefore:v
}),t._trigger("showTip");
},P=o.action;
_!==h&&h&&(p||("changeToAuto"===P||++c>e?(k(),b(),w()):t._o.auto.loadRetryTime+=1)),
t._o.auto.isShowTip=p;
}();
}
},
onPlay:function(e,o){
console.log("[onPlaying]",i.myPlayer.getResolutionInfo()),t._o.auto.isChangeAuto===!0&&t._o.auto.isShowSuc===!1&&i.myPlayer.getResolutionInfo()&&i.myPlayer.getResolutionInfo().src.indexOf("m3u8")&&!function(){
var e=null,o=4e3,r=function(){
e&&clearTimeout(e),e=setTimeout(function(){
i.myPlayer.autoChangeTip({
type:"autoSuc",
option:"hide"
});
},o);
};
i.myPlayer.hideControllBar(),i.myPlayer.autoChangeTip({
type:"autoSuc",
option:"show"
}),r(),t._o.auto.isShowSuc=!0;
}(),t._trigger("play",o);
},
onAfterCheckVideoFit:function(e,i){
var o={
97:1
};
i.needToFit===!0&&(o[98]=1,o[100]=1,i.os.ios&&(o[103]=1),i.os.android&&(o[106]=1),
i.supportObjectFit===!0&&(o[101]=1,i.os.ios&&(o[104]=1),i.os.android&&(o[107]=1))),
t._trigger("setMonitor",_,o),t._trigger("sendMonitor",_);
},
onBindError:function(e,i){
t._trigger("bindError",i);
},
onRateChange:function(e,i){
t._trigger("rateChange",i);
},
onResolutionChange:function(e,i){
"changed"===i.action&&(Q.playerStatus.formatId=i.infoAfter&&i.infoAfter.formatId||null,
D.invoke("handleMPPageAction",{
action:"setLocalData",
key:"formatId",
data:String(Q.playerStatus.formatId)
},function(e){
console.log("setLocalData"+JSON.stringify(e));
}),v()),t._trigger("resolutionChange",i);
},
onBrightnessChange:function(e,i){
t._trigger("brightnessChange",i);
},
onVolumeChange:function(e,i){
t._trigger("volumeChange",i);
},
onProfileJump:function(e,i){
t._trigger("profileJump",i);
},
onProcessStateChange:function(e,i){
t._trigger("processStateChange",i);
},
onGetDanmuInfo:function(e,i){
t._trigger("getDanmuInfo",i);
},
onCanplay:function(e,i){
t._trigger("canplay",i);
},
onShowControllBar:function(e,i){
t._trigger("showControlBar",i);
},
onHideControllBar:function(e,i){
t._trigger("hideControlBar",i);
},
canMePlay:function(e){
o.checkNoPaid?S({
type:"GET",
dataType:"json",
timeout:3e4,
url:"/mp/videoplayer?action=check_video_paid_status&__biz="+o.__biz+"&mid="+o.mid+"&idx="+o.idx,
success:function(t){
var i=1==t.can_play;
i?e():window.weui.confirm("此视频来自于付费内容，在原文付费后才可播放",{
buttons:[{
type:"default",
label:"取消"
},{
label:"前往原文",
onClick:function(){
o.openArticle();
}
}]
});
},
error:function(e){
var t=void 0;
t=e?e.status>=200&&e.status<400?81:e.status>=400&&e.status<500?82:e.status>=500&&e.status<600?83:0==e.status&&4==e.readyState?84:85:80,
onError({
err_msg:N,
code:t
});
}
}):e();
},
onShowMenu:function(e,i){
t._trigger("showMenu",i);
}
}),this._pvReport(),this._trigger("playerReady"),o.__count__=0,o.__hasReport=!1,
"string"==typeof o.container&&"#"==o.container.charAt(0)&&document.getElementById(o.container.substr(1)).getElementsByClassName("js_video_play_controll")[0].addEventListener("click",function(){
o.__count__++;
});
},o.prototype.getReportTypeBySceneType=function(){
return 0==this._o.scene_type?1:1==this._o.scene_type||2==this._o.scene_type?2:4==this._o.scene_type?3:7==this._o.scene_type?4:0;
},o.prototype._getFromid=function(){
return this._o.fromid;
},o.prototype._bindResize=function(){
var e=this;
U.on(window,"resize",function(){
return e._g.myPlayer&&e._g.myPlayer._useWcSlPlayer()?void(e._g.myPlayer.isInFullScreen()||setTimeout(function(){
var t=$(e._o.container),i=t.offset().width;
0!=i&&e.setVideoCSS({
width:i+"px"
});
},0)):void(e._o.height&&e._o.width&&(e._g.isShowTx&&e._g.txPlayer?setTimeout(function(){
try{
var t=$(e._o.container),i=e._o.width/e._o.height,o=t.offset().width,r=Math.floor(o/i);
0!=o&&(e._g.gWidth=o,e._g.gHeight=r,t.css({
height:r+"px"
}),e._g.txPlayer.resize({
width:o,
height:r
}));
}catch(a){}
},0):setTimeout(function(){
var t=$(e._o.container),i=e._o.width/e._o.height,o=t.offset().width,r=Math.floor(o/i);
0!=o&&(e._g.gWidth=o,e._g.gHeight=r,e.setVideoCSS({
width:o+"px",
height:r+"px"
}),t.css({
height:r+"px"
}));
},0)));
},!1);
},o.prototype._setBlockPlugin=function(e,t){
this._blockPlugin[e]=t;
},o.prototype._trigger=function(e){
var t=void 0,i=void 0,o=this.plugins,r=this._blockPlugin[e]||this._blockPlugin.all,a=0;
if(r&&"function"==typeof r.recv&&(t=r.recv.apply(r,arguments),"[object Object]"==Object.prototype.toString.call(t)?(a|=t.code,
i=t.data):a|=t,1&a))return i;
for(var n=0,s=o.length;s>n&&(t=o[n].recv.apply(o[n],arguments),"[object Object]"==Object.prototype.toString.call(t)?(a|=t.code,
i=t.data):a|=t,!(2&a));++n);
if(!(this._blockInnerHandler||4&a)){
var d=this["__"+e+"Handler"];
d&&(t=d.apply(this,arguments),"[object Object]"==Object.prototype.toString.call(t)&&(i=t.data));
}
return 8&a||this.__triggerOutside.apply(this,arguments),i;
},o.prototype.__triggerOutside=function(){
var e=this._o,t=arguments,i=t[0];
if(i){
i=i.substr(0,1).toUpperCase()+i.substr(1);
var o=e["on"+i];
"function"==typeof o&&o.apply(this,t);
}
},o.prototype._getCover=function(){
var e=this._o;
return p(e.vid,e.ratio,e.is_mp_video);
},o.prototype._cacheData=function(){
var e=this._g.myPlayer,t=this._g.vInfo;
e&&(t.status||(t.status={}),"function"==typeof e.isEnd&&(t.status.isEnd=e.isEnd()),
"function"==typeof e.getCurTime&&(t.status.playTime=e.getCurTime()),"function"==typeof e.getPlaybackRate&&(t.status.playbackRate=e.getPlaybackRate()),
!this._g.initialData&&this._g.coverUrl&&(t.coverUrl=this._g.coverUrl),h(this._o.__biz,this._o.mid,this._o.idx,this._o.vid,this._g.vInfo,this._g.cacheStartTs));
},o.prototype._getCache=function(){
var e=g(this._o.__biz,this._o.mid,this._o.idx,this._o.vid);
if(e){
var t=this._g.vInfo;
t.dynamicData=e.videoInfo.dynamicData||null,t.coverUrl=e.videoInfo.coverUrl||"",
t.status=e.videoInfo.status||null,this._g.cacheStartTs=e.time||null;
}
},o.prototype._clearCache=function(){
f(this._o.vid);
},o.prototype._qqVideoReport=function(e){
var t={
step:e.step,
loadwait:e.loadwait||0,
val:e.val||0,
vid:this._o.vid
};
6==e.step&&(t.vt=this._report.vt),V.qqvideo_common_report(t);
},o.prototype._pvReport=function(){
this._qqVideoReport({
step:3
});
},o.prototype._showError=function(e,t){
t=t||1;
var i=this,o=this._report.videoerror,r=y(this._o.container.replace(/^#/,""));
if(r){
e=e||N;
var a=!1;
e===N&&(a=!0),r.innerHTML=q.tmpl(W,{
errType:t,
msg:e,
errcode:o,
showBtn:a,
width:r.offsetWidth,
height:r.offsetHeight,
is_mp_video:this._o.is_mp_video
},!1);
{
var n=$(r).find(".js_video_errormsg_btn");
$(r).find(".js_video_errormsg_loading"),$(r).find(".js_error_area");
}
U.tap(n[0],function(){
i._reInit();
});
}
},o.prototype._reInit=function(){
var e=y(this._o.container.replace(/^#/,""));
e.innerHTML="";
var t=!1,i=!1;
Q.isUseProxy&&this._report.videoerror>=41&&this._report.videoerror<=46&&(t=!0,this._g.noProxy&&(i=!0)),
this._init({
noProxy:t,
hasReportProxyError:i,
hasInitPlugins:!0,
gWidth:this._g.gWidth,
gHeight:this._g.gHeight
});
},o.prototype.__showEndContentHandler=function(){
this._debug("resetVideo"),this._g.myPlayer._useWcSlPlayer()?this._g.myPlayer.showCover():this._g.myPlayer.resetVideo(),
this._g.myPlayer.hidePlayBtn();
},o.prototype._debug=function(){},o.prototype.__ariaReplayHandler=function(){
this.__replayHandler();
},o.prototype.__replayHandler=function(){
this._g.is_report_pv=!1,this._qqVideoReport({
step:3
}),this._report.replay=1,this._g.myPlayer.replay();
},o.prototype._getTraceId=function(){
var e=this._g.myAdPlugin;
return e?e.getTraceId():0;
},o.prototype._getOrderid=function(){
var e=this._g.myAdPlugin;
return e?e.getOrderid():0;
},o.prototype._getOriStatus=function(){
return this._o.ori_status;
},o.prototype._getPlayerReportData=function(){
var e=this._report,t=this._g.myPlayer,i=this._g.myAdPlugin;
t&&(e.quick_play=t.hasDrag()?1:0,e.full_screen=t.hasFullScreen()?1:0,e.drag_times=t.getDrag().join(":|:"),
e.play_time=this.getRealPlayTime()),i&&(e.ad_play_time=i.getAdPlaytime(),e.traceid=i.getTraceId(),
e.orderid=i.getOrderid()),e.webviewid=B.getWebviewid();
},o.prototype._cacheReportData=function(){
var e=this;
this._g.reportDataTimeoutId&&(clearTimeout(this._g.reportDataTimeoutId),this._g.reportDataTimeoutId=null),
!Q.videoDataLs||this._g.hasReport||this._g.hasDestroy||(this._getPlayerReportData(),
Q.videoDataLs.set(this._g.reportDataLsKey,this._report,+new Date+Q.videoDataLsExpTime)),
Q.neeedTimoutSaveReportData&&!this._g.hasDestroy&&(this._g.reportDataTimeoutId=window.setTimeout(function(){
e._cacheReportData();
},1e3));
},o.prototype.getVid=function(){
return this._o.vid;
},o.prototype.pause=function(){
this._g.myPlayer&&this._g.myPlayer.pause4outer();
},o.prototype.play=function(e){
this._g.myPlayer&&this._g.myPlayer.play4outer(e);
},o.prototype.firstPlay=function(){
this._g.myPlayer&&this._g.myPlayer.firstPlay();
},o.prototype.resetVideo=function(){
this._g.myPlayer&&this._g.myPlayer.resetVideo();
},o.prototype.getRealPlayTime=function(){
var e=0;
return this._g.myPlayer&&(e=Math.round(1e3*this._g.myPlayer.getPlayTotalTime())),
e;
},o.prototype.getCurrentTime=function(){
var e=0,t=this._g.myPlayer;
return this._g.myPlayer&&(e=t.getCurTime()),e;
},o.prototype.getVideoData=function(){
return this._g.vInfo&&this._g.vInfo.dynamicData&&this._g.vInfo.dynamicData.data?this._g.vInfo.dynamicData.data:null;
},o.prototype.getReportData=function(){
return this._report;
},o.prototype.mpVideoReport=function(e){
if(e=e||{},!this._g.hasReport&&!this._g.hasDestroy){
this._g.hasReport=!0;
var t=this._report;
0===t.videoerror?this.cacheData():this.clearCache(),Q.videoDataLs&&Q.videoDataLs.remove(this._g.reportDataLsKey),
this._getPlayerReportData(),Q._debug&&console.log("report video data:"+JSON.stringify(t)),
V.videoreport({
data:t,
async:e.async
});
}
},o.prototype.extendMpReportData=function(e){
w(this._report,e);
},o.prototype.getMpReportData=function(){
return this._report;
},o.prototype.clearCache=function(){
this._clearCache();
},o.prototype.cacheData=function(){
this._cacheData();
},o.prototype._cacheOnPageInvisible=function(){
var e=this;
document.addEventListener("visibilitychange",function(){
document.hidden&&e.cacheData();
});
},o.prototype._leaveReport12710=function(){
var e=this,t={
type:this._o.leaveReport12710Type,
step:17,
useruin:this._o.uin,
bizuin:this._o.__biz,
mid:this._o.mid,
idx:this._o.idx,
vid:this._o.vid
};
G.addReport(function(){
var i=e.getRealPlayTime();
if(!i)return!1;
var o=e.getVideoData();
return t.duration=Math.round(1e3*o.time),t.clienttime=Date.now(),t.real_play_time=i,
{
reportUrl:"https://mp.weixin.qq.com/mp/ad_video_report?action=video_play_exit_report",
reportData:Object.keys(t).map(function(e){
return e+"="+encodeURIComponent(t[e]||"");
}).join("&"),
method:"POST"
};
});
},o.prototype.setWidth=function(e){
this._g.myPlayer.setWidth(e);
},o.prototype.setHeight=function(e){
this._g.myPlayer.setHeight(e);
},o.prototype.renderLike=function(){
var e=this._g.myPlayer;
e&&e.isEnd()&&this._trigger("showEndContent");
},o.prototype.setVideoCSS=function(e){
var t=this,i=this._g.myPlayer,o=this._g.myAdPlugin;
i&&(i.setVideoCSS(e),o&&o.setSize(e),setTimeout(function(){
t.renderLike();
},0));
var r=$(this._o.container).find(".js_error_box");
r&&r.length>0&&r.css(e);
},o.prototype.destroy=function(){
for(var e=0;e<Q.videoInstance.length;e++)Q.videoInstance[e]===this&&(Q.videoInstance.splice(e,1),
e--);
this._g&&(this._g.event&&T.removeListener({
type:"afterRemoveLoading",
func:this._g.event.afterRemoveLoading
}),this._g.myPlayer&&this._g.myPlayer.destroy(),this._g.hasDestroy=!0);
},o.prototype.supportWcSlPlayer=function(){
return!!this._g.myPlayer&&this._g.myPlayer.supportWcSlPlayer();
};
var Y=-1!=navigator.userAgent.indexOf("MicroMessenger")&&(I.isIOS||I.isAndroid||I.isWp);
return{
getHashByVid:c,
mpVideoPlayer:o,
getFormatTime:A._getFormatTime,
getCoverByVid:p,
getQQVideoStaticInfo:_
};
});define("pages/modules/recommend_reason_article/msg_item.html.js",[],function(){
return'<# if (msg.is_finder_item) { #>\n\n<!-- 视频号视频 -->\n<div class="article_item js_article js_wx_tap_highlight wx_tap_cell image-text-item special-card-item"\n  data-jump_url="<#=msg.jump_url#>"\n  data-send_time="<#=msg.send_time#>"\n  data-is_read="<#=msg.is_read#>"\n  data-pos="<#=pos#>"\n  data-item_show_type="<#=itemShowType#>"\n  data-pv="<#=pv#>"\n  data-like_cnt="<#=likeCnt#>"\n  data-friend_readed="<#=friendReaded#>"\n  data-friend_comment="<#=friendComment#>"\n  data-if_top_comment="<#=hasTopComment#>"\n  data-top_comment_text="<#=topCommentText#>"\n  data-top_comment_length="<#=topCommentLength#>"\n  data-idx="<#=idx#>"\n  data-vid="<#=vid#>"\n  data-video_duration="<#=msg.video_duration#>"\n  data-object_id="<#=msg.finder_info.object_id#>"\n  data-export_id="<#=msg.finder_info.export_id#>"\n  data-object_nonce_id="<#=msg.finder_info.object_nonce_id#>"\n  data-media_type="<#=msg.finder_info.media_type#>"\n  data-is_finder_item="1"\n>\n  <!-- 当是视频卡片的时候，div.article_item_inner加上类名“video_item_inner” -->\n  <div class="article_item_inner js_article_item video_item_inner">\n    <!-- 视频的标题 -->\n    <div class="article__title"<# if(!msg.title) { #> style="display:none"<# } #>><#= msg.title #></div>\n    <!--  渲染视频封面图 + 播放 icon + 时长 -->\n    <div class="article__video-img" style="background-image: url(<#=msg.cover_url.htmlDecode()#>);">\n      <div class="article__video-img__middle">\n        <i class="article__video-img__middle__icon"></i>\n        <div class="article__video-img__middle__time"><#=videoDuration#></div>\n      </div>\n    </div>\n    <!-- 所有类型都有这一块 -->\n    <div class="article__extinfo video__extinfo" style="<# if(msg.style_flag>0) { #>margin-right:0<# }#>">\n      <# if (msg.recommend_reason && msg.recommend_reason.wording) { #>\n      <div class="album__item-tag"\n        data-text-color="<#=msg.recommend_reason.text_color#>"\n        data-bg-color="<#=msg.recommend_reason.background_color#>"\n        data-dark-text-color="<#=msg.recommend_reason.dark_mode_text_color#>"\n        data-dark-bg-color="<#=msg.recommend_reason.dark_mode_background_color#>"\n        <# if (!isDarkMode) { #>\n          style="background-color:<#=msg.recommend_reason.background_color#>;color:<#=msg.recommend_reason.text_color#>"\n        <# } else { #>\n          style="background-color:<#=msg.recommend_reason.dark_mode_background_color#>;color:<#=msg.recommend_reason.dark_mode_text_color#>"\n        <# } #>\n      ><#=msg.recommend_reason.wording#></div>\n      <# } #>\n      <span class="extinfo__item"><#=msg.biz_info.name#></span>\n      <# if (msg.read_cnt > 0) { #>\n        <div class="extinfo__item">观看<#=readCnt#></div>\n      <# } #>\n\n      <# if (msg.friend_read_cnt >= 3 || msg.like_cnt >= 1000 || msg.comment_cnt >= 20) { #>\n        <div class="extinfo__item">\n          <# if (msg.friend_read_cnt >= 3) { #>\n            <#=msg.friend_read_cnt#>位朋友读过          <# } else if (msg.like_cnt >= 1000) { #>\n            赞<#=likeCnt#>          <# } else if (msg.comment_cnt >= 20) { #>\n            精选留言<#=msg.comment_cnt#>          <# } #>\n        </div>\n      <# } #>\n    </div>\n  </div>\n  <!-- 外显留言 -->\n  <# if (hasTopComment) { #>\n  <div class="article_item_comment">\n    <div class="article_item_comment__word">精选留言</div>\n    <div class="article_item_comment__content"><#==topCommentText#></div>\n  </div>\n  <# } #>\n</div>\n\n<# } else { #>\n\n<!--当是音频item时加上 media_item 类名, 当是图文话题页的推荐item时，加上image-text-item-->\n<!-- 两行标题时，加 has-two-line-title类名 -->\n<!-- special-card-item: 视频大卡、图片大卡、三图卡片的时候加上这个类名 -->\n<div class="article_item js_article js_wx_tap_highlight wx_tap_cell <# if (msg.type === 3) { #>media_item<# } #> <# if (msg.type !== 3) { #>image-text-item<# } #> <# if (msg.style_flag === 1 || msg.style_flag === 2 || msg.type === 2) { #>special-card-item<# } #>"\n  data-jump_url="<#=msg.jump_url#>"\n  data-send_time="<#=msg.send_time#>"\n  data-is_read="<#=msg.is_read#>"\n  data-pos="<#=pos#>"\n  data-item_show_type="<#=itemShowType#>"\n  data-pv="<#=pv#>"\n  data-like_cnt="<#=likeCnt#>"\n  data-friend_readed="<#=friendReaded#>"\n  data-friend_comment="<#=friendComment#>"\n  data-if_top_comment="<#=hasTopComment#>"\n  data-top_comment_text="<#=topCommentText#>"\n  data-top_comment_length="<#=topCommentLength#>"\n  data-idx="<#=idx#>"\n  data-vid="<#=vid#>"\n  data-video_duration="<#=msg.video_duration#>"\n>\n  <!-- 当是视频卡片的时候，div.article_item_inner加上类名“video_item_inner” -->\n  <div class="article_item_inner js_article_item <# if (msg.type === 2) { #>video_item_inner<# } #>">\n\n    <!-- 视频的标题 -->\n    <# if (msg.type === 2) { #>\n      <div class="article__title"<# if(!msg.title) { #> style="display:none"<# } #>><#= msg.title #></div>\n      <!--\n        视频满足自动播放的条件 -> 渲染 myPLayer 视频播放器\n        不满足自动播放的条件 -> 渲染视频封面图 + 播放 icon + 时长\n      -->\n      <# if (canAutoPlay) { #>\n        <div id="WXPLAYABLEVIDEO<#=idx#>" class="js_video_player" style="height: <#=videoPlayerHeight#>px;"></div>\n        <# } else { #>\n        <div class="article__video-img" style="background-image: url(<#=msg.cover_url#>);">\n          <div class="article__video-img__middle">\n            <i class="article__video-img__middle__icon"></i>\n            <div class="article__video-img__middle__time"><#=videoDuration#></div>\n          </div>\n        </div>\n      <# } #>\n    <# } #>\n\n    <# if (msg.type !== 2) { #>\n      <!-- 非视频 -->\n      <div class="article__subinfo">\n        <!-- 图文的标题 -->\n        <div class="article__title"<# if(!msg.title) { #> style="display:none"<# } #>>\n          <span><#= msg.title #></span>\n          <# if (msg.is_payread > 0) { #>\n          <span class="unpay__tag" style="margin-top:-2px">付费</span>\n          <# } #>\n        </div>\n        <# if (msg.style_flag === 2) { #>\n          <div class="three-img-wrp">\n            <# for(var i = 0; i < 3; i++){ #>\n            <div class="special-img__image-item" style="background-image: url(<#=msg.pic_url[i]#>);"></div>\n            <# } #>\n          </div>\n        <# } else if (msg.style_flag === 1) { #>\n          <div class="special-img__image" style="background-image: url(<#=msg.cover_url#>);"></div>\n        <# } #>\n    <# } #>\n\n        <!-- 所有类型都有这一块 -->\n        <div class="article__extinfo<# if (msg.type === 2) { #> video__extinfo<# } #>" style="<# if (msg.type !== 2) { #>visibility:hidden;<# } #><# if(msg.style_flag>0) { #>margin-right:0;<# }#><# if (tagType === 22) { #>margin-top:12px;display:flex;<# }#>">\n          <# if (tagType !== 22) { #>\n            <# if (msg.recommend_reason && msg.recommend_reason.wording) { #>\n            <div class="album__item-tag"\n              data-text-color="<#=msg.recommend_reason.text_color#>"\n              data-bg-color="<#=msg.recommend_reason.background_color#>"\n              data-dark-text-color="<#=msg.recommend_reason.dark_mode_text_color#>"\n              data-dark-bg-color="<#=msg.recommend_reason.dark_mode_background_color#>"\n              <# if (!isDarkMode) { #>\n                style="background-color:<#=msg.recommend_reason.background_color#>;color:<#=msg.recommend_reason.text_color#>"\n              <# } else { #>\n                style="background-color:<#=msg.recommend_reason.dark_mode_background_color#>;color:<#=msg.recommend_reason.dark_mode_text_color#>"\n              <# } #>\n            ><#=msg.recommend_reason.wording#></div>\n            <# } #>\n            <span class="extinfo__item"><#=msg.biz_info.name#></span>\n\n            <# if (tagType === 24 && massSendTime) { #>\n              <span class="extinfo__item"><#=massSendTime#></span>\n            <# } #>\n\n            <# if (msg.read_cnt > 0) { #>\n              <div class="extinfo__item"><# if (msg.type === 2) { #>观看<#=readCnt#><# } else { #>阅读<#=readCnt#><# } #></div>\n            <# } #>\n          <# } #>\n\n          <# if (tagType === 22) { #>\n            <!-- 头像+公众号昵称 -->\n            <div class="account_info" style="display:inline-block;margin-bottom:0;margin-right:8px;overflow:hidden;">\n              <div class="account__thumb" style="background-image: url(<#=msg.biz_info.head_img_url#>);"></div>\n              <span class="account__name" style="display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"><#=msg.biz_info.name#></span>\n            </div>\n\n            <# if (msg.comment_cnt >= 50) { #>\n              <div class="extinfo__item" style="flex-shrink:0;">精选留言<#=commentCnt#></div>\n            <# } else if (msg.like_cnt >= 100) { #>\n              <div class="extinfo__item" style="flex-shrink:0;">点赞<#=likeCnt#></div>\n            <# } else if (msg.friend_read_cnt >= 2) { #>\n              <div class="extinfo__item" style="flex-shrink:0;"><#=msg.friend_read_cnt#>位朋友读过</div>\n            <# } else if (msg.read_cnt >= 1000) { #>\n              <div class="extinfo__item" style="flex-shrink:0;">阅读<#=readCnt#></div>\n            <# } #>\n          <# } else if (msg.friend_read_cnt >= 3 || msg.like_cnt >= 1000 || msg.comment_cnt >= 20) { #>\n            <div class="extinfo__item">\n              <# if (msg.friend_read_cnt >= 3) { #>\n                <#=msg.friend_read_cnt#>位朋友读过              <# } else if (msg.like_cnt >= 1000) { #>\n                赞<#=likeCnt#>              <# } else if (msg.comment_cnt >= 20) { #>\n                精选留言<#=msg.comment_cnt#>              <# } #>\n            </div>\n          <# } #>\n        </div>\n    <# if (msg.type !== 2) { #>\n      <!-- 非视频 -->\n      </div>\n    <# } #>\n\n    <# if (msg.type === 1) { #>\n      <!-- 图文 -->\n      <# if (!msg.style_flag) { #>\n      <div class="article__thumb" style="background-image: url(<#=msg.cover_url#>);"></div>\n      <# } #>\n    <# } else if (msg.type === 2) { #>\n      <!--\n        视频满足自动播放的条件 -> 渲染 myPLayer 视频播放器\n        不满足自动播放的条件 -> 渲染视频封面图 + 播放 icon + 时长\n      -->\n      <!-- <# if (canAutoPlay) { #>\n      <div id="WXPLAYABLEVIDEO<#=idx#>" class="js_video_player" style="height: <#=videoPlayerHeight#>px;"></div>\n      <# } else { #>\n      <div class="article__video-img" style="background-image: url(<#=msg.cover_url#>);">\n        <div class="article__video-img__middle">\n          <i class="article__video-img__middle__icon"></i>\n          <div class="article__video-img__middle__time"><#=videoDuration#></div>\n        </div>\n      </div>\n      <# } #> -->\n    <# } else { #>\n      <!-- 音频 -->\n      <div class="article__thumb-wrp media__wrp">\n        <div class="article__thumb audio-icon"></div>\n        <!-- <div class="media__detail">\n            <i class="media__audio-icon"></i>\n        </div> -->\n      </div>\n    <# } #>\n\n\n  </div>\n\n  <!-- 外显留言 -->\n  <# if (hasTopComment) { #>\n  <div class="article_item_comment">\n    <div class="article_item_comment__word">精选留言</div>\n    <div class="article_item_comment__content"><#==topCommentText#></div>\n  </div>\n  <# } #>\n</div>\n\n<# } #>\n';
});define("biz_wap/jsapi/log.js",["biz_wap/jsapi/core.js","biz_wap/utils/mmversion.js"],function(i){
"use strict";
function o(i,o){
o=e+" "+o+" location:["+location.href+"]",n.isWechat&&n.isAndroid?r.invoke("log",{
level:i,
msg:o
}):n.isWechat&&(n.isIOS||n.isMac)&&r.invoke("writeLog",{
level:i,
msg:o
});
}
var r=i("biz_wap/jsapi/core.js"),n=i("biz_wap/utils/mmversion.js"),e="__wap__",a={
info:function(){
o("info",Array.prototype.join.apply(arguments));
},
warn:function(){
o("warn",Array.prototype.join.apply(arguments));
},
error:function(){
o("error",Array.prototype.join.apply(arguments));
},
debug:function(){
o("debug",Array.prototype.join.apply(arguments));
}
};
return a.log=a.info,a;
});define("biz_wap/utils/storage.js",[],function(){
"use strict";
function t(t){
return"[WXLS] "+t;
}
function e(e,n,r){
if(!e)throw"require function name.";
this.evictionPolicy="noeviction",this.key=e,i[e]=function(){},"function"==typeof r&&(i[e]=function(e,n){
r(t(e),n);
}),-1!==Object.keys(c).indexOf(n)&&(this.evictionPolicy=n),this.init();
}
var n="__WXLS__",i={},r=window.localStorage||{
getItem:function(){},
setItem:function(){},
removeItem:function(){},
key:function(){},
length:0
},c={
noeviction:function(t){
return t;
},
"allkeys-random":function(t,e){
for(var n=Object.keys(t),i=0;e>i;){
var r=n.length,c=Math.floor(Math.random()*r),o=n[c];
i+=JSON.stringify(t[o]).length,delete t[o],n=Object.keys(t);
}
return t;
},
"volatile-ttl":function(t,e){
var n=Object.keys(t);
n=n.sort(function(e,n){
var i=t[e],r=t[n];
return i.exp<r.exp?-1:i.exp>r.exp?1:0;
});
for(var i=0,r=0;r<n.length&&!(i>=e);r++){
var c=n[r];
i+=JSON.stringify(t[c]).length,delete t[c];
}
return t;
},
"clear-all":function(){
return r.clear(),{};
}
};
return e.getItem=function(t){
return t=n+t,r.getItem(t);
},e.setItem=function(t,c){
var o=t;
t=n+t;
for(var s=3;s--;)try{
r.setItem(t,c),i[o]("setItem success: key:"+t+" val:"+c,"success");
break;
}catch(a){
i[o]("setItem error:"+a,"error"),e.clear();
}
},e.clear=function(){
var t,e;
for(t=r.length-1;t>=0;t--)e=r.key(t),0==e.indexOf(n)&&r.removeItem(e);
},e.getSupportEvicationPolicy=function(){
return Object.keys(c);
},e.prototype={
constructor:e,
init:function(){
this.check();
},
getData:function(){
var t=e.getItem(this.key)||"{}";
try{
t=JSON.parse(t);
}catch(n){
i[this.key]("getData error:"+n,"error"),t={};
}
return t;
},
check:function(t){
var n,r,c=this.getData(),o={},s=+new Date;
for(n in c)r=c[n],+r.exp>s&&(o[n]=r);
return i[this.key]("check info: isReturn:"+t+" data:"+JSON.stringify(o),"info"),
t?o:void e.setItem(this.key,JSON.stringify(o));
},
set:function(t,c,o){
var s=this.check(!0);
s[t]={
val:c,
exp:o||+new Date
};
try{
r.setItem(n+this.key,JSON.stringify(s)),i[this.key]("first set success: key:"+n+this.key+" data:"+JSON.stringify(s),"success");
}catch(a){
r.clear(),e.setItem(this.key,JSON.stringify(s));
}
},
get:function(t){
var e=this.getData();
return e=e[t],e?e.val||null:null;
},
remove:function(t){
var n=this.getData();
n[t]&&delete n[t],e.setItem(this.key,JSON.stringify(n));
}
},e;
});